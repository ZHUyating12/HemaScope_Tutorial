<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 ScRNA-seq Pipeline | HemaScope Tutorial</title>
  <meta name="description" content="This is the tutorial for HemaScope." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="3 ScRNA-seq Pipeline | HemaScope Tutorial" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the tutorial for HemaScope." />
  <meta name="github-repo" content="https://github.com/ZhenyiWangTHU/HemaScopeR/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 ScRNA-seq Pipeline | HemaScope Tutorial" />
  
  <meta name="twitter:description" content="This is the tutorial for HemaScope." />
  

<meta name="author" content="Zhenyi Wang, Yuxin Miao, and Junyi Zhang" />


<meta name="date" content="2024-07-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installation.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">HemaScope</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="installation.html"><a href="installation.html#install-r-and-python"><i class="fa fa-check"></i><b>2.1</b> Install R and python</a></li>
<li class="chapter" data-level="2.2" data-path="installation.html"><a href="installation.html#install-required-r-packages"><i class="fa fa-check"></i><b>2.2</b> Install required R-packages</a></li>
<li class="chapter" data-level="2.3" data-path="installation.html"><a href="installation.html#install-required-python-packages"><i class="fa fa-check"></i><b>2.3</b> Install required Python-packages</a></li>
<li class="chapter" data-level="2.4" data-path="installation.html"><a href="installation.html#install-hemascoper"><i class="fa fa-check"></i><b>2.4</b> Install HemaScopeR</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html"><i class="fa fa-check"></i><b>3</b> ScRNA-seq Pipeline</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#the-integrated-pipeline"><i class="fa fa-check"></i><b>3.1</b> The Integrated Pipeline</a></li>
<li class="chapter" data-level="3.2" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-1.-load-data"><i class="fa fa-check"></i><b>3.2</b> Step 1. Load Data</a></li>
<li class="chapter" data-level="3.3" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-2.-quality-control"><i class="fa fa-check"></i><b>3.3</b> Step 2. Quality Control</a></li>
<li class="chapter" data-level="3.4" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-3.-clustering"><i class="fa fa-check"></i><b>3.4</b> Step 3. Clustering</a></li>
<li class="chapter" data-level="3.5" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-4.-identify-cell-types"><i class="fa fa-check"></i><b>3.5</b> Step 4. Identify Cell Types</a></li>
<li class="chapter" data-level="3.6" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-5.-visualization"><i class="fa fa-check"></i><b>3.6</b> Step 5. Visualization</a></li>
<li class="chapter" data-level="3.7" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-6.-find-degs"><i class="fa fa-check"></i><b>3.7</b> Step 6. Find DEGs</a></li>
<li class="chapter" data-level="3.8" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-7.-assign-cell-cycles"><i class="fa fa-check"></i><b>3.8</b> Step 7. Assign Cell Cycles</a></li>
<li class="chapter" data-level="3.9" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-8.-calculate-heterogeneity"><i class="fa fa-check"></i><b>3.9</b> Step 8. Calculate Heterogeneity</a></li>
<li class="chapter" data-level="3.10" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-9.-violin-plot-for-marker-genes"><i class="fa fa-check"></i><b>3.10</b> Step 9. Violin Plot for Marker Genes</a></li>
<li class="chapter" data-level="3.11" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-10.-calculate-lineage-scores"><i class="fa fa-check"></i><b>3.11</b> Step 10. Calculate Lineage Scores</a></li>
<li class="chapter" data-level="3.12" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-11.-gsva"><i class="fa fa-check"></i><b>3.12</b> Step 11. GSVA</a></li>
<li class="chapter" data-level="3.13" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-12.-construct-trajectories"><i class="fa fa-check"></i><b>3.13</b> Step 12. Construct Trajectories</a></li>
<li class="chapter" data-level="3.14" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-13.-tf-analysis"><i class="fa fa-check"></i><b>3.14</b> Step 13. TF Analysis</a></li>
<li class="chapter" data-level="3.15" data-path="scrna-seq-pipeline.html"><a href="scrna-seq-pipeline.html#step-14.-cell-cell-interaction"><i class="fa fa-check"></i><b>3.15</b> Step 14. Cell-Cell Interaction</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">HemaScope Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="scrna-seq-pipeline" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> ScRNA-seq Pipeline<a href="scrna-seq-pipeline.html#scrna-seq-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-integrated-pipeline" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> The Integrated Pipeline<a href="scrna-seq-pipeline.html#the-integrated-pipeline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Load the R packages.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="scrna-seq-pipeline.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sc libraries</span></span>
<span id="cb12-2"><a href="scrna-seq-pipeline.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb12-3"><a href="scrna-seq-pipeline.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phateR)</span>
<span id="cb12-4"><a href="scrna-seq-pipeline.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubletFinder)</span>
<span id="cb12-5"><a href="scrna-seq-pipeline.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(monocle)</span>
<span id="cb12-6"><a href="scrna-seq-pipeline.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slingshot)</span>
<span id="cb12-7"><a href="scrna-seq-pipeline.html#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(URD)</span>
<span id="cb12-8"><a href="scrna-seq-pipeline.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GSVA)</span>
<span id="cb12-9"><a href="scrna-seq-pipeline.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(limma)</span>
<span id="cb12-10"><a href="scrna-seq-pipeline.html#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb12-11"><a href="scrna-seq-pipeline.html#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-12"><a href="scrna-seq-pipeline.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Mm.eg.db)</span>
<span id="cb12-13"><a href="scrna-seq-pipeline.html#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Hs.eg.db)</span>
<span id="cb12-14"><a href="scrna-seq-pipeline.html#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CellChat)</span>
<span id="cb12-15"><a href="scrna-seq-pipeline.html#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(velocyto.R)</span>
<span id="cb12-16"><a href="scrna-seq-pipeline.html#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SeuratWrappers)</span>
<span id="cb12-17"><a href="scrna-seq-pipeline.html#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb12-18"><a href="scrna-seq-pipeline.html#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scran)</span>
<span id="cb12-19"><a href="scrna-seq-pipeline.html#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb12-20"><a href="scrna-seq-pipeline.html#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb12-21"><a href="scrna-seq-pipeline.html#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb12-22"><a href="scrna-seq-pipeline.html#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb12-23"><a href="scrna-seq-pipeline.html#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb12-24"><a href="scrna-seq-pipeline.html#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SCENIC)</span>
<span id="cb12-25"><a href="scrna-seq-pipeline.html#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feather)</span>
<span id="cb12-26"><a href="scrna-seq-pipeline.html#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AUCell)</span>
<span id="cb12-27"><a href="scrna-seq-pipeline.html#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcisTarget)</span>
<span id="cb12-28"><a href="scrna-seq-pipeline.html#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb12-29"><a href="scrna-seq-pipeline.html#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb12-30"><a href="scrna-seq-pipeline.html#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb12-31"><a href="scrna-seq-pipeline.html#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(clusterProfiler)</span>
<span id="cb12-32"><a href="scrna-seq-pipeline.html#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(OpenXGR)</span>
<span id="cb12-33"><a href="scrna-seq-pipeline.html#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co"># st libraries</span></span>
<span id="cb12-34"><a href="scrna-seq-pipeline.html#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb12-35"><a href="scrna-seq-pipeline.html#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rfast2)</span>
<span id="cb12-36"><a href="scrna-seq-pipeline.html#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SeuratDisk)</span>
<span id="cb12-37"><a href="scrna-seq-pipeline.html#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abcCellmap)</span>
<span id="cb12-38"><a href="scrna-seq-pipeline.html#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biomaRt)</span>
<span id="cb12-39"><a href="scrna-seq-pipeline.html#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(copykat)</span>
<span id="cb12-40"><a href="scrna-seq-pipeline.html#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gelnet)</span>
<span id="cb12-41"><a href="scrna-seq-pipeline.html#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-42"><a href="scrna-seq-pipeline.html#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallelDist)</span>
<span id="cb12-43"><a href="scrna-seq-pipeline.html#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb12-44"><a href="scrna-seq-pipeline.html#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(markdown)</span>
<span id="cb12-45"><a href="scrna-seq-pipeline.html#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co"># getpot</span></span>
<span id="cb12-46"><a href="scrna-seq-pipeline.html#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(getopt)</span>
<span id="cb12-47"><a href="scrna-seq-pipeline.html#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tools)</span>
<span id="cb12-48"><a href="scrna-seq-pipeline.html#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># HemaScopeR</span></span>
<span id="cb12-49"><a href="scrna-seq-pipeline.html#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HemaScopeR)</span></code></pre></div>
<ul>
<li>Run the integrated scRNA-seq pipeline.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="scrna-seq-pipeline.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scRNASeq_10x_pipeline</span>(</span>
<span id="cb13-2"><a href="scrna-seq-pipeline.html#cb13-2" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># input and output</span></span>
<span id="cb13-3"><a href="scrna-seq-pipeline.html#cb13-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">input.data.dirs =</span> <span class="fu">c</span>(<span class="st">&#39;./SRR7881399/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-4"><a href="scrna-seq-pipeline.html#cb13-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881400/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-5"><a href="scrna-seq-pipeline.html#cb13-5" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881401/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-6"><a href="scrna-seq-pipeline.html#cb13-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881402/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-7"><a href="scrna-seq-pipeline.html#cb13-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881403/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-8"><a href="scrna-seq-pipeline.html#cb13-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881404/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-9"><a href="scrna-seq-pipeline.html#cb13-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881405/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-10"><a href="scrna-seq-pipeline.html#cb13-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881406/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-11"><a href="scrna-seq-pipeline.html#cb13-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881407/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-12"><a href="scrna-seq-pipeline.html#cb13-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881408/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-13"><a href="scrna-seq-pipeline.html#cb13-13" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881409/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-14"><a href="scrna-seq-pipeline.html#cb13-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881410/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-15"><a href="scrna-seq-pipeline.html#cb13-15" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881411/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-16"><a href="scrna-seq-pipeline.html#cb13-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881412/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-17"><a href="scrna-seq-pipeline.html#cb13-17" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881413/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-18"><a href="scrna-seq-pipeline.html#cb13-18" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881414/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-19"><a href="scrna-seq-pipeline.html#cb13-19" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881415/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-20"><a href="scrna-seq-pipeline.html#cb13-20" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881416/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-21"><a href="scrna-seq-pipeline.html#cb13-21" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881417/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-22"><a href="scrna-seq-pipeline.html#cb13-22" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881418/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-23"><a href="scrna-seq-pipeline.html#cb13-23" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881419/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-24"><a href="scrna-seq-pipeline.html#cb13-24" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881420/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-25"><a href="scrna-seq-pipeline.html#cb13-25" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881421/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-26"><a href="scrna-seq-pipeline.html#cb13-26" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881422/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb13-27"><a href="scrna-seq-pipeline.html#cb13-27" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;./SRR7881423/outs/filtered_feature_bc_matrix&#39;</span>),</span>
<span id="cb13-28"><a href="scrna-seq-pipeline.html#cb13-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">project.names =</span> <span class="fu">c</span>(  <span class="st">&#39;SRR7881399&#39;</span>,</span>
<span id="cb13-29"><a href="scrna-seq-pipeline.html#cb13-29" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881400&#39;</span>,</span>
<span id="cb13-30"><a href="scrna-seq-pipeline.html#cb13-30" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881401&#39;</span>,</span>
<span id="cb13-31"><a href="scrna-seq-pipeline.html#cb13-31" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881402&#39;</span>,</span>
<span id="cb13-32"><a href="scrna-seq-pipeline.html#cb13-32" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881403&#39;</span>,</span>
<span id="cb13-33"><a href="scrna-seq-pipeline.html#cb13-33" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881404&#39;</span>,</span>
<span id="cb13-34"><a href="scrna-seq-pipeline.html#cb13-34" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881405&#39;</span>,</span>
<span id="cb13-35"><a href="scrna-seq-pipeline.html#cb13-35" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881406&#39;</span>,</span>
<span id="cb13-36"><a href="scrna-seq-pipeline.html#cb13-36" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881407&#39;</span>,</span>
<span id="cb13-37"><a href="scrna-seq-pipeline.html#cb13-37" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881408&#39;</span>,</span>
<span id="cb13-38"><a href="scrna-seq-pipeline.html#cb13-38" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881409&#39;</span>,</span>
<span id="cb13-39"><a href="scrna-seq-pipeline.html#cb13-39" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881410&#39;</span>,</span>
<span id="cb13-40"><a href="scrna-seq-pipeline.html#cb13-40" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881411&#39;</span>,</span>
<span id="cb13-41"><a href="scrna-seq-pipeline.html#cb13-41" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881412&#39;</span>,</span>
<span id="cb13-42"><a href="scrna-seq-pipeline.html#cb13-42" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881413&#39;</span>,</span>
<span id="cb13-43"><a href="scrna-seq-pipeline.html#cb13-43" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881414&#39;</span>,</span>
<span id="cb13-44"><a href="scrna-seq-pipeline.html#cb13-44" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881415&#39;</span>,</span>
<span id="cb13-45"><a href="scrna-seq-pipeline.html#cb13-45" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881416&#39;</span>,</span>
<span id="cb13-46"><a href="scrna-seq-pipeline.html#cb13-46" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881417&#39;</span>,</span>
<span id="cb13-47"><a href="scrna-seq-pipeline.html#cb13-47" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881418&#39;</span>,</span>
<span id="cb13-48"><a href="scrna-seq-pipeline.html#cb13-48" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881419&#39;</span>,</span>
<span id="cb13-49"><a href="scrna-seq-pipeline.html#cb13-49" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881420&#39;</span>,</span>
<span id="cb13-50"><a href="scrna-seq-pipeline.html#cb13-50" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881421&#39;</span>,</span>
<span id="cb13-51"><a href="scrna-seq-pipeline.html#cb13-51" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881422&#39;</span>,</span>
<span id="cb13-52"><a href="scrna-seq-pipeline.html#cb13-52" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;SRR7881423&#39;</span>), </span>
<span id="cb13-53"><a href="scrna-seq-pipeline.html#cb13-53" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output.dir =</span> <span class="st">&#39;./output/&#39;</span>,</span>
<span id="cb13-54"><a href="scrna-seq-pipeline.html#cb13-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pythonPath =</span> <span class="st">&#39;/home/anaconda3/envs/HemaScopeR/bin/python&#39;</span>,</span>
<span id="cb13-55"><a href="scrna-seq-pipeline.html#cb13-55" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># quality control and preprocessing</span></span>
<span id="cb13-56"><a href="scrna-seq-pipeline.html#cb13-56" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gene.column =</span> <span class="dv">2</span>,</span>
<span id="cb13-57"><a href="scrna-seq-pipeline.html#cb13-57" aria-hidden="true" tabindex="-1"></a>                     <span class="at">min.cells =</span> <span class="dv">10</span>,</span>
<span id="cb13-58"><a href="scrna-seq-pipeline.html#cb13-58" aria-hidden="true" tabindex="-1"></a>                     <span class="at">min.feature =</span> <span class="dv">200</span>,</span>
<span id="cb13-59"><a href="scrna-seq-pipeline.html#cb13-59" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mt.pattern =</span> <span class="st">&#39;^MT-&#39;</span>,</span>
<span id="cb13-60"><a href="scrna-seq-pipeline.html#cb13-60" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nFeature_RNA.limit =</span> <span class="dv">200</span>,</span>
<span id="cb13-61"><a href="scrna-seq-pipeline.html#cb13-61" aria-hidden="true" tabindex="-1"></a>                     <span class="at">percent.mt.limit =</span> <span class="dv">20</span>,</span>
<span id="cb13-62"><a href="scrna-seq-pipeline.html#cb13-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">scale.factor =</span> <span class="dv">10000</span>,</span>
<span id="cb13-63"><a href="scrna-seq-pipeline.html#cb13-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nfeatures =</span> <span class="dv">3000</span>,</span>
<span id="cb13-64"><a href="scrna-seq-pipeline.html#cb13-64" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ndims =</span> <span class="dv">50</span>,</span>
<span id="cb13-65"><a href="scrna-seq-pipeline.html#cb13-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">vars.to.regress =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-66"><a href="scrna-seq-pipeline.html#cb13-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">PCs =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">35</span>,</span>
<span id="cb13-67"><a href="scrna-seq-pipeline.html#cb13-67" aria-hidden="true" tabindex="-1"></a>                     <span class="at">resolution =</span> <span class="fl">0.4</span>,</span>
<span id="cb13-68"><a href="scrna-seq-pipeline.html#cb13-68" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n.neighbors =</span> <span class="dv">50</span>,</span>
<span id="cb13-69"><a href="scrna-seq-pipeline.html#cb13-69" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># remove doublets</span></span>
<span id="cb13-70"><a href="scrna-seq-pipeline.html#cb13-70" aria-hidden="true" tabindex="-1"></a>                     <span class="at">doublet.percentage =</span> <span class="fl">0.04</span>,</span>
<span id="cb13-71"><a href="scrna-seq-pipeline.html#cb13-71" aria-hidden="true" tabindex="-1"></a>                     <span class="at">doublerFinderwraper.PCs =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb13-72"><a href="scrna-seq-pipeline.html#cb13-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">doublerFinderwraper.pN =</span> <span class="fl">0.25</span>,</span>
<span id="cb13-73"><a href="scrna-seq-pipeline.html#cb13-73" aria-hidden="true" tabindex="-1"></a>                     <span class="at">doublerFinderwraper.pK =</span> <span class="fl">0.1</span>,</span>
<span id="cb13-74"><a href="scrna-seq-pipeline.html#cb13-74" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># phateR</span></span>
<span id="cb13-75"><a href="scrna-seq-pipeline.html#cb13-75" aria-hidden="true" tabindex="-1"></a>                     <span class="at">phate.knn =</span> <span class="dv">50</span>,</span>
<span id="cb13-76"><a href="scrna-seq-pipeline.html#cb13-76" aria-hidden="true" tabindex="-1"></a>                     <span class="at">phate.npca =</span> <span class="dv">20</span>,</span>
<span id="cb13-77"><a href="scrna-seq-pipeline.html#cb13-77" aria-hidden="true" tabindex="-1"></a>                     <span class="at">phate.t =</span> <span class="dv">10</span>,</span>
<span id="cb13-78"><a href="scrna-seq-pipeline.html#cb13-78" aria-hidden="true" tabindex="-1"></a>                     <span class="at">phate.ndim =</span> <span class="dv">2</span>,</span>
<span id="cb13-79"><a href="scrna-seq-pipeline.html#cb13-79" aria-hidden="true" tabindex="-1"></a>                     <span class="at">min.pct =</span> <span class="fl">0.25</span>,</span>
<span id="cb13-80"><a href="scrna-seq-pipeline.html#cb13-80" aria-hidden="true" tabindex="-1"></a>                     <span class="at">logfc.threshold =</span> <span class="fl">0.25</span>,</span>
<span id="cb13-81"><a href="scrna-seq-pipeline.html#cb13-81" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># visualization</span></span>
<span id="cb13-82"><a href="scrna-seq-pipeline.html#cb13-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ViolinPlot.cellTypeOrders =</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">22</span>),</span>
<span id="cb13-83"><a href="scrna-seq-pipeline.html#cb13-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ViolinPlot.cellTypeColors =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-84"><a href="scrna-seq-pipeline.html#cb13-84" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Org =</span> <span class="st">&#39;hsa&#39;</span>,</span>
<span id="cb13-85"><a href="scrna-seq-pipeline.html#cb13-85" aria-hidden="true" tabindex="-1"></a>                     <span class="at">loom.files.path =</span> <span class="fu">c</span>( <span class="st">&#39;./SRR7881399/velocyto/SRR7881399.loom&#39;</span>,</span>
<span id="cb13-86"><a href="scrna-seq-pipeline.html#cb13-86" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881400/velocyto/SRR7881400.loom&#39;</span>,</span>
<span id="cb13-87"><a href="scrna-seq-pipeline.html#cb13-87" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881401/velocyto/SRR7881401.loom&#39;</span>,</span>
<span id="cb13-88"><a href="scrna-seq-pipeline.html#cb13-88" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881402/velocyto/SRR7881402.loom&#39;</span>,</span>
<span id="cb13-89"><a href="scrna-seq-pipeline.html#cb13-89" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881403/velocyto/SRR7881403.loom&#39;</span>,</span>
<span id="cb13-90"><a href="scrna-seq-pipeline.html#cb13-90" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881404/velocyto/SRR7881404.loom&#39;</span>,</span>
<span id="cb13-91"><a href="scrna-seq-pipeline.html#cb13-91" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881405/velocyto/SRR7881405.loom&#39;</span>,</span>
<span id="cb13-92"><a href="scrna-seq-pipeline.html#cb13-92" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881406/velocyto/SRR7881406.loom&#39;</span>,</span>
<span id="cb13-93"><a href="scrna-seq-pipeline.html#cb13-93" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881407/velocyto/SRR7881407.loom&#39;</span>,</span>
<span id="cb13-94"><a href="scrna-seq-pipeline.html#cb13-94" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881408/velocyto/SRR7881408.loom&#39;</span>,</span>
<span id="cb13-95"><a href="scrna-seq-pipeline.html#cb13-95" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881409/velocyto/SRR7881409.loom&#39;</span>,</span>
<span id="cb13-96"><a href="scrna-seq-pipeline.html#cb13-96" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881410/velocyto/SRR7881410.loom&#39;</span>,</span>
<span id="cb13-97"><a href="scrna-seq-pipeline.html#cb13-97" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881411/velocyto/SRR7881411.loom&#39;</span>,</span>
<span id="cb13-98"><a href="scrna-seq-pipeline.html#cb13-98" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881412/velocyto/SRR7881412.loom&#39;</span>,</span>
<span id="cb13-99"><a href="scrna-seq-pipeline.html#cb13-99" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881413/velocyto/SRR7881413.loom&#39;</span>,</span>
<span id="cb13-100"><a href="scrna-seq-pipeline.html#cb13-100" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881414/velocyto/SRR7881414.loom&#39;</span>,</span>
<span id="cb13-101"><a href="scrna-seq-pipeline.html#cb13-101" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881415/velocyto/SRR7881415.loom&#39;</span>,</span>
<span id="cb13-102"><a href="scrna-seq-pipeline.html#cb13-102" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881416/velocyto/SRR7881416.loom&#39;</span>,</span>
<span id="cb13-103"><a href="scrna-seq-pipeline.html#cb13-103" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881417/velocyto/SRR7881417.loom&#39;</span>,</span>
<span id="cb13-104"><a href="scrna-seq-pipeline.html#cb13-104" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881418/velocyto/SRR7881418.loom&#39;</span>,</span>
<span id="cb13-105"><a href="scrna-seq-pipeline.html#cb13-105" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881419/velocyto/SRR7881419.loom&#39;</span>,</span>
<span id="cb13-106"><a href="scrna-seq-pipeline.html#cb13-106" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881420/velocyto/SRR7881420.loom&#39;</span>,</span>
<span id="cb13-107"><a href="scrna-seq-pipeline.html#cb13-107" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881421/velocyto/SRR7881421.loom&#39;</span>,</span>
<span id="cb13-108"><a href="scrna-seq-pipeline.html#cb13-108" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881422/velocyto/SRR7881422.loom&#39;</span>,</span>
<span id="cb13-109"><a href="scrna-seq-pipeline.html#cb13-109" aria-hidden="true" tabindex="-1"></a>                                          <span class="st">&#39;./SRR7881423/velocyto/SRR7881423.loom&#39;</span>),</span>
<span id="cb13-110"><a href="scrna-seq-pipeline.html#cb13-110" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># cell cycle</span></span>
<span id="cb13-111"><a href="scrna-seq-pipeline.html#cb13-111" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cellcycleCutoff =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-112"><a href="scrna-seq-pipeline.html#cb13-112" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># cell chat</span></span>
<span id="cb13-113"><a href="scrna-seq-pipeline.html#cb13-113" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sorting =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-114"><a href="scrna-seq-pipeline.html#cb13-114" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ncores =</span> <span class="dv">10</span>,</span>
<span id="cb13-115"><a href="scrna-seq-pipeline.html#cb13-115" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># Verbose = FALSE,</span></span>
<span id="cb13-116"><a href="scrna-seq-pipeline.html#cb13-116" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># activeEachStep</span></span>
<span id="cb13-117"><a href="scrna-seq-pipeline.html#cb13-117" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Whether_load_previous_results =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-118"><a href="scrna-seq-pipeline.html#cb13-118" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step1_Input_Data =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-119"><a href="scrna-seq-pipeline.html#cb13-119" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step1_Input_Data.type =</span> <span class="st">&#39;cellranger-count&#39;</span>,</span>
<span id="cb13-120"><a href="scrna-seq-pipeline.html#cb13-120" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step2_Quality_Control =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-121"><a href="scrna-seq-pipeline.html#cb13-121" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step2_Quality_Control.RemoveBatches =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-122"><a href="scrna-seq-pipeline.html#cb13-122" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step2_Quality_Control.RemoveDoublets =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-123"><a href="scrna-seq-pipeline.html#cb13-123" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step3_Clustering =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-124"><a href="scrna-seq-pipeline.html#cb13-124" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step4_Identify_Cell_Types =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-125"><a href="scrna-seq-pipeline.html#cb13-125" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step4_Use_Which_Labels =</span> <span class="st">&#39;clustering&#39;</span>,</span>
<span id="cb13-126"><a href="scrna-seq-pipeline.html#cb13-126" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step4_Cluster_Labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-127"><a href="scrna-seq-pipeline.html#cb13-127" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step4_Changed_Labels =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-128"><a href="scrna-seq-pipeline.html#cb13-128" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step4_run_sc_CNV =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-129"><a href="scrna-seq-pipeline.html#cb13-129" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step5_Visualization =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-130"><a href="scrna-seq-pipeline.html#cb13-130" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step6_Find_DEGs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-131"><a href="scrna-seq-pipeline.html#cb13-131" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step7_Assign_Cell_Cycle =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-132"><a href="scrna-seq-pipeline.html#cb13-132" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step8_Calculate_Heterogeneity =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-133"><a href="scrna-seq-pipeline.html#cb13-133" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step9_Violin_Plot_for_Marker_Genes =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-134"><a href="scrna-seq-pipeline.html#cb13-134" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step10_Calculate_Lineage_Scores =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-135"><a href="scrna-seq-pipeline.html#cb13-135" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step11_GSVA =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-136"><a href="scrna-seq-pipeline.html#cb13-136" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step11_GSVA.identify.cellType.features=</span><span class="cn">TRUE</span>,</span>
<span id="cb13-137"><a href="scrna-seq-pipeline.html#cb13-137" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step11_GSVA.identify.diff.features=</span><span class="cn">FALSE</span>,</span>
<span id="cb13-138"><a href="scrna-seq-pipeline.html#cb13-138" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step11_GSVA.comparison.design=</span><span class="cn">NULL</span>,</span>
<span id="cb13-139"><a href="scrna-seq-pipeline.html#cb13-139" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step12_Construct_Trajectories =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-140"><a href="scrna-seq-pipeline.html#cb13-140" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step12_Construct_Trajectories.clusters =</span> <span class="fu">c</span>(<span class="st">&#39;3&#39;</span>,<span class="st">&#39;6&#39;</span>,<span class="st">&#39;9&#39;</span>,<span class="st">&#39;10&#39;</span>,<span class="st">&#39;11&#39;</span>,<span class="st">&#39;14&#39;</span>,<span class="st">&#39;15&#39;</span>,<span class="st">&#39;19&#39;</span>), </span>
<span id="cb13-141"><a href="scrna-seq-pipeline.html#cb13-141" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step12_Construct_Trajectories.monocle =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-142"><a href="scrna-seq-pipeline.html#cb13-142" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step12_Construct_Trajectories.slingshot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-143"><a href="scrna-seq-pipeline.html#cb13-143" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step12_Construct_Trajectories.scVelo =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-144"><a href="scrna-seq-pipeline.html#cb13-144" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step13_TF_Analysis =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-145"><a href="scrna-seq-pipeline.html#cb13-145" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step14_Cell_Cell_Interaction =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-146"><a href="scrna-seq-pipeline.html#cb13-146" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Step15_Generate_the_Report =</span> <span class="cn">TRUE</span></span>
<span id="cb13-147"><a href="scrna-seq-pipeline.html#cb13-147" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
</div>
<div id="step-1.-load-data" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Step 1. Load Data<a href="scrna-seq-pipeline.html#step-1.-load-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Set the paths for the input data, the output results, and the Python installation.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="scrna-seq-pipeline.html#cb14-1" aria-hidden="true" tabindex="-1"></a>input.data.dirs <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;./SRR7881399/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-2"><a href="scrna-seq-pipeline.html#cb14-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881400/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-3"><a href="scrna-seq-pipeline.html#cb14-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881401/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-4"><a href="scrna-seq-pipeline.html#cb14-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881402/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-5"><a href="scrna-seq-pipeline.html#cb14-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881403/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-6"><a href="scrna-seq-pipeline.html#cb14-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881404/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-7"><a href="scrna-seq-pipeline.html#cb14-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881405/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-8"><a href="scrna-seq-pipeline.html#cb14-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881406/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-9"><a href="scrna-seq-pipeline.html#cb14-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881407/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-10"><a href="scrna-seq-pipeline.html#cb14-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881408/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-11"><a href="scrna-seq-pipeline.html#cb14-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881409/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-12"><a href="scrna-seq-pipeline.html#cb14-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881410/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-13"><a href="scrna-seq-pipeline.html#cb14-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881411/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-14"><a href="scrna-seq-pipeline.html#cb14-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881412/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-15"><a href="scrna-seq-pipeline.html#cb14-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881413/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-16"><a href="scrna-seq-pipeline.html#cb14-16" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881414/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-17"><a href="scrna-seq-pipeline.html#cb14-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881415/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-18"><a href="scrna-seq-pipeline.html#cb14-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881416/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-19"><a href="scrna-seq-pipeline.html#cb14-19" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881417/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-20"><a href="scrna-seq-pipeline.html#cb14-20" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881418/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-21"><a href="scrna-seq-pipeline.html#cb14-21" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881419/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-22"><a href="scrna-seq-pipeline.html#cb14-22" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881420/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-23"><a href="scrna-seq-pipeline.html#cb14-23" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881421/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-24"><a href="scrna-seq-pipeline.html#cb14-24" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881422/outs/filtered_feature_bc_matrix&#39;</span>,</span>
<span id="cb14-25"><a href="scrna-seq-pipeline.html#cb14-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;./SRR7881423/outs/filtered_feature_bc_matrix&#39;</span>)</span>
<span id="cb14-26"><a href="scrna-seq-pipeline.html#cb14-26" aria-hidden="true" tabindex="-1"></a>output.dir <span class="ot">=</span> <span class="st">&#39;./output/&#39;</span></span>
<span id="cb14-27"><a href="scrna-seq-pipeline.html#cb14-27" aria-hidden="true" tabindex="-1"></a>pythonPath <span class="ot">=</span> <span class="st">&#39;/home/anaconda3/envs/HemaScopeR/bin/python&#39;</span></span></code></pre></div>
<ul>
<li>Set the parameters for loading the data sets.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="scrna-seq-pipeline.html#cb15-1" aria-hidden="true" tabindex="-1"></a>project.names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;SRR7881399&#39;</span>,</span>
<span id="cb15-2"><a href="scrna-seq-pipeline.html#cb15-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881400&#39;</span>,</span>
<span id="cb15-3"><a href="scrna-seq-pipeline.html#cb15-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881401&#39;</span>,</span>
<span id="cb15-4"><a href="scrna-seq-pipeline.html#cb15-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881402&#39;</span>,</span>
<span id="cb15-5"><a href="scrna-seq-pipeline.html#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881403&#39;</span>,</span>
<span id="cb15-6"><a href="scrna-seq-pipeline.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881404&#39;</span>,</span>
<span id="cb15-7"><a href="scrna-seq-pipeline.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881405&#39;</span>,</span>
<span id="cb15-8"><a href="scrna-seq-pipeline.html#cb15-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881406&#39;</span>,</span>
<span id="cb15-9"><a href="scrna-seq-pipeline.html#cb15-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881407&#39;</span>,</span>
<span id="cb15-10"><a href="scrna-seq-pipeline.html#cb15-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881408&#39;</span>,</span>
<span id="cb15-11"><a href="scrna-seq-pipeline.html#cb15-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881409&#39;</span>,</span>
<span id="cb15-12"><a href="scrna-seq-pipeline.html#cb15-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881410&#39;</span>,</span>
<span id="cb15-13"><a href="scrna-seq-pipeline.html#cb15-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881411&#39;</span>,</span>
<span id="cb15-14"><a href="scrna-seq-pipeline.html#cb15-14" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881412&#39;</span>,</span>
<span id="cb15-15"><a href="scrna-seq-pipeline.html#cb15-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881413&#39;</span>,</span>
<span id="cb15-16"><a href="scrna-seq-pipeline.html#cb15-16" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881414&#39;</span>,</span>
<span id="cb15-17"><a href="scrna-seq-pipeline.html#cb15-17" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881415&#39;</span>,</span>
<span id="cb15-18"><a href="scrna-seq-pipeline.html#cb15-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881416&#39;</span>,</span>
<span id="cb15-19"><a href="scrna-seq-pipeline.html#cb15-19" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881417&#39;</span>,</span>
<span id="cb15-20"><a href="scrna-seq-pipeline.html#cb15-20" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881418&#39;</span>,</span>
<span id="cb15-21"><a href="scrna-seq-pipeline.html#cb15-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881419&#39;</span>,</span>
<span id="cb15-22"><a href="scrna-seq-pipeline.html#cb15-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881420&#39;</span>,</span>
<span id="cb15-23"><a href="scrna-seq-pipeline.html#cb15-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881421&#39;</span>,</span>
<span id="cb15-24"><a href="scrna-seq-pipeline.html#cb15-24" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881422&#39;</span>,</span>
<span id="cb15-25"><a href="scrna-seq-pipeline.html#cb15-25" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SRR7881423&#39;</span>)</span>
<span id="cb15-26"><a href="scrna-seq-pipeline.html#cb15-26" aria-hidden="true" tabindex="-1"></a>gene.column <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb15-27"><a href="scrna-seq-pipeline.html#cb15-27" aria-hidden="true" tabindex="-1"></a>min.cells <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb15-28"><a href="scrna-seq-pipeline.html#cb15-28" aria-hidden="true" tabindex="-1"></a>min.feature <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb15-29"><a href="scrna-seq-pipeline.html#cb15-29" aria-hidden="true" tabindex="-1"></a>mt.pattern <span class="ot">=</span> <span class="st">&#39;^MT-&#39;</span></span>
<span id="cb15-30"><a href="scrna-seq-pipeline.html#cb15-30" aria-hidden="true" tabindex="-1"></a>Step1_Input_Data.type <span class="ot">=</span> <span class="st">&#39;cellranger-count&#39;</span></span></code></pre></div>
<ul>
<li>Create folders for saving the results of HemaScopeR analysis.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="scrna-seq-pipeline.html#cb16-1" aria-hidden="true" tabindex="-1"></a>wdir <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb16-2"><a href="scrna-seq-pipeline.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="scrna-seq-pipeline.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(pythonPath)<span class="sc">==</span><span class="cn">FALSE</span>){ reticulate<span class="sc">::</span><span class="fu">use_python</span>(pythonPath) }<span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&#39;Please set the path of Python.&#39;</span>)}</span>
<span id="cb16-4"><a href="scrna-seq-pipeline.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="scrna-seq-pipeline.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/HemaScopeR_results/&#39;</span>))) {</span>
<span id="cb16-6"><a href="scrna-seq-pipeline.html#cb16-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/HemaScopeR_results/&#39;</span>))</span>
<span id="cb16-7"><a href="scrna-seq-pipeline.html#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="scrna-seq-pipeline.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="scrna-seq-pipeline.html#cb16-9" aria-hidden="true" tabindex="-1"></a>output.dir <span class="ot">&lt;-</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/HemaScopeR_results/&#39;</span>)</span>
<span id="cb16-10"><a href="scrna-seq-pipeline.html#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="scrna-seq-pipeline.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>))) {</span>
<span id="cb16-12"><a href="scrna-seq-pipeline.html#cb16-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>))</span>
<span id="cb16-13"><a href="scrna-seq-pipeline.html#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="scrna-seq-pipeline.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="scrna-seq-pipeline.html#cb16-15" aria-hidden="true" tabindex="-1"></a>previous_results_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>)  </span>
<span id="cb16-16"><a href="scrna-seq-pipeline.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># if (Whether_load_previous_results) {</span></span>
<span id="cb16-17"><a href="scrna-seq-pipeline.html#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    print(&#39;Loading the previous results...&#39;) </span></span>
<span id="cb16-18"><a href="scrna-seq-pipeline.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#    Load_previous_results(previous_results_path = previous_results_path)</span></span>
<span id="cb16-19"><a href="scrna-seq-pipeline.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb16-20"><a href="scrna-seq-pipeline.html#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="scrna-seq-pipeline.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step1. Input data-----------------------------------------------------------------------------</span></span>
<span id="cb16-22"><a href="scrna-seq-pipeline.html#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="scrna-seq-pipeline.html#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step1. Input data.&#39;</span>)</span>
<span id="cb16-24"><a href="scrna-seq-pipeline.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step1.Input_data/&#39;</span>))) {</span>
<span id="cb16-25"><a href="scrna-seq-pipeline.html#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step1.Input_data/&#39;</span>))</span>
<span id="cb16-26"><a href="scrna-seq-pipeline.html#cb16-26" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<ul>
<li>Load the data sets.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="scrna-seq-pipeline.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">file.copy</span>(<span class="at">from =</span> input.data.dirs, <span class="at">to =</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step1.Input_data/&#39;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-2"><a href="scrna-seq-pipeline.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="scrna-seq-pipeline.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Step1_Input_Data.type <span class="sc">==</span> <span class="st">&#39;cellranger-count&#39;</span>){</span>
<span id="cb17-4"><a href="scrna-seq-pipeline.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb17-5"><a href="scrna-seq-pipeline.html#cb17-5" aria-hidden="true" tabindex="-1"></a>    input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb17-6"><a href="scrna-seq-pipeline.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(input.data.dirs)) {</span>
<span id="cb17-7"><a href="scrna-seq-pipeline.html#cb17-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-8"><a href="scrna-seq-pipeline.html#cb17-8" aria-hidden="true" tabindex="-1"></a>          sc_data.temp <span class="ot">&lt;-</span> <span class="fu">Read10X</span>(<span class="at">data.dir =</span> input.data.dirs[i],</span>
<span id="cb17-9"><a href="scrna-seq-pipeline.html#cb17-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">gene.column =</span> gene.column)</span>
<span id="cb17-10"><a href="scrna-seq-pipeline.html#cb17-10" aria-hidden="true" tabindex="-1"></a>          sc_object.temp <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> sc_data.temp,</span>
<span id="cb17-11"><a href="scrna-seq-pipeline.html#cb17-11" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">project =</span> project.names[i],</span>
<span id="cb17-12"><a href="scrna-seq-pipeline.html#cb17-12" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">min.cells =</span> min.cells,</span>
<span id="cb17-13"><a href="scrna-seq-pipeline.html#cb17-13" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">min.feature =</span> min.feature)</span>
<span id="cb17-14"><a href="scrna-seq-pipeline.html#cb17-14" aria-hidden="true" tabindex="-1"></a>          sc_object.temp[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object.temp, <span class="at">pattern =</span> mt.pattern)</span>
<span id="cb17-15"><a href="scrna-seq-pipeline.html#cb17-15" aria-hidden="true" tabindex="-1"></a>          input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>(input.data.list, sc_object.temp)}</span>
<span id="cb17-16"><a href="scrna-seq-pipeline.html#cb17-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-17"><a href="scrna-seq-pipeline.html#cb17-17" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb17-18"><a href="scrna-seq-pipeline.html#cb17-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-19"><a href="scrna-seq-pipeline.html#cb17-19" aria-hidden="true" tabindex="-1"></a>          sc_data <span class="ot">&lt;-</span> <span class="fu">Read10X</span>(<span class="at">data.dir =</span> input.data.dirs,</span>
<span id="cb17-20"><a href="scrna-seq-pipeline.html#cb17-20" aria-hidden="true" tabindex="-1"></a>                             <span class="at">gene.column =</span> gene.column)</span>
<span id="cb17-21"><a href="scrna-seq-pipeline.html#cb17-21" aria-hidden="true" tabindex="-1"></a>          sc_object <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> sc_data,</span>
<span id="cb17-22"><a href="scrna-seq-pipeline.html#cb17-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">project =</span> project.names,</span>
<span id="cb17-23"><a href="scrna-seq-pipeline.html#cb17-23" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">min.cells =</span> min.cells,</span>
<span id="cb17-24"><a href="scrna-seq-pipeline.html#cb17-24" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">min.feature =</span> min.feature)</span>
<span id="cb17-25"><a href="scrna-seq-pipeline.html#cb17-25" aria-hidden="true" tabindex="-1"></a>          sc_object[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object, <span class="at">pattern =</span> mt.pattern) </span>
<span id="cb17-26"><a href="scrna-seq-pipeline.html#cb17-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-27"><a href="scrna-seq-pipeline.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-28"><a href="scrna-seq-pipeline.html#cb17-28" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step1_Input_Data.type <span class="sc">==</span> <span class="st">&#39;Seurat&#39;</span>){</span>
<span id="cb17-29"><a href="scrna-seq-pipeline.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb17-30"><a href="scrna-seq-pipeline.html#cb17-30" aria-hidden="true" tabindex="-1"></a>    input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb17-31"><a href="scrna-seq-pipeline.html#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(input.data.dirs)) {</span>
<span id="cb17-32"><a href="scrna-seq-pipeline.html#cb17-32" aria-hidden="true" tabindex="-1"></a>          sc_object.temp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(input.data.dirs[i])</span>
<span id="cb17-33"><a href="scrna-seq-pipeline.html#cb17-33" aria-hidden="true" tabindex="-1"></a>          sc_object.temp[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object.temp, <span class="at">pattern =</span> mt.pattern)</span>
<span id="cb17-34"><a href="scrna-seq-pipeline.html#cb17-34" aria-hidden="true" tabindex="-1"></a>          input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>(input.data.list, sc_object.temp)</span>
<span id="cb17-35"><a href="scrna-seq-pipeline.html#cb17-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-36"><a href="scrna-seq-pipeline.html#cb17-36" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb17-37"><a href="scrna-seq-pipeline.html#cb17-37" aria-hidden="true" tabindex="-1"></a>      sc_object <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(input.data.dirs)</span>
<span id="cb17-38"><a href="scrna-seq-pipeline.html#cb17-38" aria-hidden="true" tabindex="-1"></a>      sc_object[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object, <span class="at">pattern =</span> mt.pattern) </span>
<span id="cb17-39"><a href="scrna-seq-pipeline.html#cb17-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-40"><a href="scrna-seq-pipeline.html#cb17-40" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step1_Input_Data.type <span class="sc">==</span> <span class="st">&#39;Matrix&#39;</span>){</span>
<span id="cb17-41"><a href="scrna-seq-pipeline.html#cb17-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb17-42"><a href="scrna-seq-pipeline.html#cb17-42" aria-hidden="true" tabindex="-1"></a>    input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb17-43"><a href="scrna-seq-pipeline.html#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(input.data.dirs)) {</span>
<span id="cb17-44"><a href="scrna-seq-pipeline.html#cb17-44" aria-hidden="true" tabindex="-1"></a>          sc_data.temp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(input.data.dirs[i])</span>
<span id="cb17-45"><a href="scrna-seq-pipeline.html#cb17-45" aria-hidden="true" tabindex="-1"></a>          sc_object.temp <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> sc_data.temp,</span>
<span id="cb17-46"><a href="scrna-seq-pipeline.html#cb17-46" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">project =</span> project.names[i],</span>
<span id="cb17-47"><a href="scrna-seq-pipeline.html#cb17-47" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">min.cells =</span> min.cells,</span>
<span id="cb17-48"><a href="scrna-seq-pipeline.html#cb17-48" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">min.feature =</span> min.feature)</span>
<span id="cb17-49"><a href="scrna-seq-pipeline.html#cb17-49" aria-hidden="true" tabindex="-1"></a>          sc_object.temp[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object.temp, <span class="at">pattern =</span> mt.pattern)</span>
<span id="cb17-50"><a href="scrna-seq-pipeline.html#cb17-50" aria-hidden="true" tabindex="-1"></a>          input.data.list <span class="ot">&lt;-</span> <span class="fu">c</span>(input.data.list, sc_object.temp)}</span>
<span id="cb17-51"><a href="scrna-seq-pipeline.html#cb17-51" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-52"><a href="scrna-seq-pipeline.html#cb17-52" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb17-53"><a href="scrna-seq-pipeline.html#cb17-53" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-54"><a href="scrna-seq-pipeline.html#cb17-54" aria-hidden="true" tabindex="-1"></a>          sc_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(input.data.dirs)</span>
<span id="cb17-55"><a href="scrna-seq-pipeline.html#cb17-55" aria-hidden="true" tabindex="-1"></a>          sc_object <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> sc_data,</span>
<span id="cb17-56"><a href="scrna-seq-pipeline.html#cb17-56" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">project =</span> project.names,</span>
<span id="cb17-57"><a href="scrna-seq-pipeline.html#cb17-57" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">min.cells =</span> min.cells,</span>
<span id="cb17-58"><a href="scrna-seq-pipeline.html#cb17-58" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">min.feature =</span> min.feature)</span>
<span id="cb17-59"><a href="scrna-seq-pipeline.html#cb17-59" aria-hidden="true" tabindex="-1"></a>          sc_object[[<span class="st">&quot;percent.mt&quot;</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(sc_object, <span class="at">pattern =</span> mt.pattern) </span>
<span id="cb17-60"><a href="scrna-seq-pipeline.html#cb17-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-61"><a href="scrna-seq-pipeline.html#cb17-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-62"><a href="scrna-seq-pipeline.html#cb17-62" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb17-63"><a href="scrna-seq-pipeline.html#cb17-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&#39;Please input data generated by the cellranger-count software, or a Seurat object, or a gene expression matrix. HemaScopeR does not support other formats of input data.&#39;</span>)</span>
<span id="cb17-64"><a href="scrna-seq-pipeline.html#cb17-64" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="scrna-seq-pipeline.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb18-2"><a href="scrna-seq-pipeline.html#cb18-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb18-3"><a href="scrna-seq-pipeline.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb18-4"><a href="scrna-seq-pipeline.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb18-5"><a href="scrna-seq-pipeline.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb18-6"><a href="scrna-seq-pipeline.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb18-7"><a href="scrna-seq-pipeline.html#cb18-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-2.-quality-control" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Step 2. Quality Control<a href="scrna-seq-pipeline.html#step-2.-quality-control" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Set the parameters for quality control.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="scrna-seq-pipeline.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quality control and preprocessing</span></span>
<span id="cb19-2"><a href="scrna-seq-pipeline.html#cb19-2" aria-hidden="true" tabindex="-1"></a>nFeature_RNA.limit <span class="ot">=</span> <span class="dv">200</span></span>
<span id="cb19-3"><a href="scrna-seq-pipeline.html#cb19-3" aria-hidden="true" tabindex="-1"></a>percent.mt.limit <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb19-4"><a href="scrna-seq-pipeline.html#cb19-4" aria-hidden="true" tabindex="-1"></a>scale.factor <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb19-5"><a href="scrna-seq-pipeline.html#cb19-5" aria-hidden="true" tabindex="-1"></a>nfeatures <span class="ot">=</span> <span class="dv">3000</span></span>
<span id="cb19-6"><a href="scrna-seq-pipeline.html#cb19-6" aria-hidden="true" tabindex="-1"></a>ndims <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb19-7"><a href="scrna-seq-pipeline.html#cb19-7" aria-hidden="true" tabindex="-1"></a>vars.to.regress <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb19-8"><a href="scrna-seq-pipeline.html#cb19-8" aria-hidden="true" tabindex="-1"></a>PCs <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">35</span></span>
<span id="cb19-9"><a href="scrna-seq-pipeline.html#cb19-9" aria-hidden="true" tabindex="-1"></a>resolution <span class="ot">=</span> <span class="fl">0.4</span></span>
<span id="cb19-10"><a href="scrna-seq-pipeline.html#cb19-10" aria-hidden="true" tabindex="-1"></a>n.neighbors <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb19-11"><a href="scrna-seq-pipeline.html#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># remove doublets</span></span>
<span id="cb19-12"><a href="scrna-seq-pipeline.html#cb19-12" aria-hidden="true" tabindex="-1"></a>doublet.percentage <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb19-13"><a href="scrna-seq-pipeline.html#cb19-13" aria-hidden="true" tabindex="-1"></a>doublerFinderwraper.PCs <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb19-14"><a href="scrna-seq-pipeline.html#cb19-14" aria-hidden="true" tabindex="-1"></a>doublerFinderwraper.pN <span class="ot">=</span> <span class="fl">0.25</span></span>
<span id="cb19-15"><a href="scrna-seq-pipeline.html#cb19-15" aria-hidden="true" tabindex="-1"></a>doublerFinderwraper.pK <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb19-16"><a href="scrna-seq-pipeline.html#cb19-16" aria-hidden="true" tabindex="-1"></a>Step2_Quality_Control.RemoveBatches <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb19-17"><a href="scrna-seq-pipeline.html#cb19-17" aria-hidden="true" tabindex="-1"></a>Step2_Quality_Control.RemoveDoublets <span class="ot">=</span> <span class="cn">TRUE</span></span></code></pre></div>
<ul>
<li>Create a folder for saving the results of quality control.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="scrna-seq-pipeline.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step2. Quality control.&#39;</span>)</span>
<span id="cb20-2"><a href="scrna-seq-pipeline.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step2.Quality_control/&#39;</span>))) {</span>
<span id="cb20-3"><a href="scrna-seq-pipeline.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step2.Quality_control/&#39;</span>))</span>
<span id="cb20-4"><a href="scrna-seq-pipeline.html#cb20-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run the quality control process.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="scrna-seq-pipeline.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb21-2"><a href="scrna-seq-pipeline.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># preprocess and quality control for multiple scRNA-Seq data sets</span></span>
<span id="cb21-3"><a href="scrna-seq-pipeline.html#cb21-3" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">QC_multiple_scRNASeq</span>(<span class="at">seuratObjects =</span> input.data.list,</span>
<span id="cb21-4"><a href="scrna-seq-pipeline.html#cb21-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">datasetID =</span> project.names,</span>
<span id="cb21-5"><a href="scrna-seq-pipeline.html#cb21-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step2.Quality_control/&#39;</span>),</span>
<span id="cb21-6"><a href="scrna-seq-pipeline.html#cb21-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Step2_Quality_Control.RemoveBatches =</span> Step2_Quality_Control.RemoveBatches,</span>
<span id="cb21-7"><a href="scrna-seq-pipeline.html#cb21-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Step2_Quality_Control.RemoveDoublets =</span> Step2_Quality_Control.RemoveDoublets,</span>
<span id="cb21-8"><a href="scrna-seq-pipeline.html#cb21-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">nFeature_RNA.limit =</span> nFeature_RNA.limit,</span>
<span id="cb21-9"><a href="scrna-seq-pipeline.html#cb21-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">percent.mt.limit =</span> percent.mt.limit,</span>
<span id="cb21-10"><a href="scrna-seq-pipeline.html#cb21-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">scale.factor =</span> scale.factor,</span>
<span id="cb21-11"><a href="scrna-seq-pipeline.html#cb21-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">nfeatures =</span> nfeatures,</span>
<span id="cb21-12"><a href="scrna-seq-pipeline.html#cb21-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">ndims =</span> ndims,</span>
<span id="cb21-13"><a href="scrna-seq-pipeline.html#cb21-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">vars.to.regress =</span> vars.to.regress,</span>
<span id="cb21-14"><a href="scrna-seq-pipeline.html#cb21-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">PCs =</span> PCs,</span>
<span id="cb21-15"><a href="scrna-seq-pipeline.html#cb21-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">resolution =</span> resolution,</span>
<span id="cb21-16"><a href="scrna-seq-pipeline.html#cb21-16" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n.neighbors =</span> n.neighbors,</span>
<span id="cb21-17"><a href="scrna-seq-pipeline.html#cb21-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">percentage =</span> doublet.percentage,</span>
<span id="cb21-18"><a href="scrna-seq-pipeline.html#cb21-18" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">doublerFinderwraper.PCs =</span> doublerFinderwraper.PCs,</span>
<span id="cb21-19"><a href="scrna-seq-pipeline.html#cb21-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">doublerFinderwraper.pN =</span> doublerFinderwraper.pN,</span>
<span id="cb21-20"><a href="scrna-seq-pipeline.html#cb21-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">doublerFinderwraper.pK =</span> doublerFinderwraper.pK</span>
<span id="cb21-21"><a href="scrna-seq-pipeline.html#cb21-21" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb21-22"><a href="scrna-seq-pipeline.html#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="scrna-seq-pipeline.html#cb21-23" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb21-24"><a href="scrna-seq-pipeline.html#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># preprocess and quality control for single scRNA-Seq data set</span></span>
<span id="cb21-25"><a href="scrna-seq-pipeline.html#cb21-25" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">QC_single_scRNASeq</span>(<span class="at">sc_object =</span> sc_object,</span>
<span id="cb21-26"><a href="scrna-seq-pipeline.html#cb21-26" aria-hidden="true" tabindex="-1"></a>                                <span class="at">datasetID =</span> project.names,</span>
<span id="cb21-27"><a href="scrna-seq-pipeline.html#cb21-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step2.Quality_control/&#39;</span>),</span>
<span id="cb21-28"><a href="scrna-seq-pipeline.html#cb21-28" aria-hidden="true" tabindex="-1"></a>                                <span class="at">Step2_Quality_Control.RemoveDoublets =</span> Step2_Quality_Control.RemoveDoublets,</span>
<span id="cb21-29"><a href="scrna-seq-pipeline.html#cb21-29" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nFeature_RNA.limit =</span> nFeature_RNA.limit,</span>
<span id="cb21-30"><a href="scrna-seq-pipeline.html#cb21-30" aria-hidden="true" tabindex="-1"></a>                                <span class="at">percent.mt.limit =</span> percent.mt.limit,</span>
<span id="cb21-31"><a href="scrna-seq-pipeline.html#cb21-31" aria-hidden="true" tabindex="-1"></a>                                <span class="at">scale.factor =</span> scale.factor,</span>
<span id="cb21-32"><a href="scrna-seq-pipeline.html#cb21-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nfeatures =</span> nfeatures,</span>
<span id="cb21-33"><a href="scrna-seq-pipeline.html#cb21-33" aria-hidden="true" tabindex="-1"></a>                                <span class="at">vars.to.regress =</span> vars.to.regress,</span>
<span id="cb21-34"><a href="scrna-seq-pipeline.html#cb21-34" aria-hidden="true" tabindex="-1"></a>                                <span class="at">ndims =</span> ndims,</span>
<span id="cb21-35"><a href="scrna-seq-pipeline.html#cb21-35" aria-hidden="true" tabindex="-1"></a>                                <span class="at">PCs =</span> PCs,</span>
<span id="cb21-36"><a href="scrna-seq-pipeline.html#cb21-36" aria-hidden="true" tabindex="-1"></a>                                <span class="at">resolution =</span> resolution,</span>
<span id="cb21-37"><a href="scrna-seq-pipeline.html#cb21-37" aria-hidden="true" tabindex="-1"></a>                                <span class="at">n.neighbors =</span> n.neighbors,</span>
<span id="cb21-38"><a href="scrna-seq-pipeline.html#cb21-38" aria-hidden="true" tabindex="-1"></a>                                <span class="at">percentage =</span> doublet.percentage,</span>
<span id="cb21-39"><a href="scrna-seq-pipeline.html#cb21-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">doublerFinderwraper.PCs =</span> doublerFinderwraper.PCs,</span>
<span id="cb21-40"><a href="scrna-seq-pipeline.html#cb21-40" aria-hidden="true" tabindex="-1"></a>                                <span class="at">doublerFinderwraper.pN =</span> doublerFinderwraper.pN,</span>
<span id="cb21-41"><a href="scrna-seq-pipeline.html#cb21-41" aria-hidden="true" tabindex="-1"></a>                                <span class="at">doublerFinderwraper.pK =</span> doublerFinderwraper.pK)</span>
<span id="cb21-42"><a href="scrna-seq-pipeline.html#cb21-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="scrna-seq-pipeline.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb22-2"><a href="scrna-seq-pipeline.html#cb22-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb22-3"><a href="scrna-seq-pipeline.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb22-4"><a href="scrna-seq-pipeline.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb22-5"><a href="scrna-seq-pipeline.html#cb22-5" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb22-6"><a href="scrna-seq-pipeline.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb22-7"><a href="scrna-seq-pipeline.html#cb22-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-3.-clustering" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Step 3. Clustering<a href="scrna-seq-pipeline.html#step-3.-clustering" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Set the parameters for clustering.</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="scrna-seq-pipeline.html#cb23-1" aria-hidden="true" tabindex="-1"></a>PCs <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">35</span></span>
<span id="cb23-2"><a href="scrna-seq-pipeline.html#cb23-2" aria-hidden="true" tabindex="-1"></a>resolution <span class="ot">=</span> <span class="fl">0.4</span></span>
<span id="cb23-3"><a href="scrna-seq-pipeline.html#cb23-3" aria-hidden="true" tabindex="-1"></a>n.neighbors <span class="ot">=</span> <span class="dv">50</span></span></code></pre></div>
<ul>
<li>Create a folder for saving the results of Louvain clustering.</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="scrna-seq-pipeline.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step3. Clustering.&#39;</span>)</span>
<span id="cb24-2"><a href="scrna-seq-pipeline.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step3.Clustering/&#39;</span>))) {</span>
<span id="cb24-3"><a href="scrna-seq-pipeline.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step3.Clustering/&#39;</span>))</span>
<span id="cb24-4"><a href="scrna-seq-pipeline.html#cb24-4" aria-hidden="true" tabindex="-1"></a>}   </span></code></pre></div>
<ul>
<li>Run Louvian clustering.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="scrna-seq-pipeline.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( (<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&amp;</span> Step2_Quality_Control.RemoveBatches ){graph.name <span class="ot">&lt;-</span> <span class="st">&#39;integrated_snn&#39;</span>}<span class="cf">else</span>{graph.name <span class="ot">&lt;-</span> <span class="st">&#39;RNA_snn&#39;</span>}</span>
<span id="cb25-2"><a href="scrna-seq-pipeline.html#cb25-2" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">FindNeighbors</span>(sc_object, <span class="at">dims =</span> PCs, <span class="at">k.param =</span> n.neighbors, <span class="at">force.recalc =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-3"><a href="scrna-seq-pipeline.html#cb25-3" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(sc_object, <span class="at">resolution =</span> resolution, <span class="at">graph.name =</span> graph.name)</span>
<span id="cb25-4"><a href="scrna-seq-pipeline.html#cb25-4" aria-hidden="true" tabindex="-1"></a>sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>seurat_clusters <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.numeric</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>seurat_clusters))</span>
<span id="cb25-5"><a href="scrna-seq-pipeline.html#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="scrna-seq-pipeline.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot clustering</span></span>
<span id="cb25-7"><a href="scrna-seq-pipeline.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step3.Clustering/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;tsne_cluster.pdf&#39;</span>), <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb25-8"><a href="scrna-seq-pipeline.html#cb25-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;tsne&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;seurat_clusters&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-9"><a href="scrna-seq-pipeline.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb25-10"><a href="scrna-seq-pipeline.html#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="scrna-seq-pipeline.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step3.Clustering/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;umap_cluster.pdf&#39;</span>), <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb25-12"><a href="scrna-seq-pipeline.html#cb25-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;seurat_clusters&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-13"><a href="scrna-seq-pipeline.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb25-14"><a href="scrna-seq-pipeline.html#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="scrna-seq-pipeline.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step3.Clustering/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;tsne_cluster.png&#39;</span>), <span class="at">width =</span> <span class="dv">600</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb25-16"><a href="scrna-seq-pipeline.html#cb25-16" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;tsne&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;seurat_clusters&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-17"><a href="scrna-seq-pipeline.html#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb25-18"><a href="scrna-seq-pipeline.html#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="scrna-seq-pipeline.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step3.Clustering/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;umap_cluster.png&#39;</span>), <span class="at">width =</span> <span class="dv">600</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb25-20"><a href="scrna-seq-pipeline.html#cb25-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;seurat_clusters&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-21"><a href="scrna-seq-pipeline.html#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()    </span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="scrna-seq-pipeline.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb26-2"><a href="scrna-seq-pipeline.html#cb26-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb26-3"><a href="scrna-seq-pipeline.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb26-4"><a href="scrna-seq-pipeline.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb26-5"><a href="scrna-seq-pipeline.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb26-6"><a href="scrna-seq-pipeline.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb26-7"><a href="scrna-seq-pipeline.html#cb26-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-4.-identify-cell-types" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Step 4. Identify Cell Types<a href="scrna-seq-pipeline.html#step-4.-identify-cell-types" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Set the path for the database.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="scrna-seq-pipeline.html#cb27-1" aria-hidden="true" tabindex="-1"></a>databasePath <span class="ot">=</span> <span class="st">&quot;~/HemaScopeR/database/&quot;</span></span></code></pre></div>
<ul>
<li>Set the parameters for cell type identification.</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="scrna-seq-pipeline.html#cb28-1" aria-hidden="true" tabindex="-1"></a>Step4_Use_Which_Labels <span class="ot">=</span> <span class="st">&#39;clustering&#39;</span></span>
<span id="cb28-2"><a href="scrna-seq-pipeline.html#cb28-2" aria-hidden="true" tabindex="-1"></a>Step4_Cluster_Labels <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb28-3"><a href="scrna-seq-pipeline.html#cb28-3" aria-hidden="true" tabindex="-1"></a>Step4_Changed_Labels <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb28-4"><a href="scrna-seq-pipeline.html#cb28-4" aria-hidden="true" tabindex="-1"></a>Org <span class="ot">=</span> <span class="st">&#39;hsa&#39;</span></span>
<span id="cb28-5"><a href="scrna-seq-pipeline.html#cb28-5" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">=</span> <span class="dv">10</span></span></code></pre></div>
<ul>
<li>Create a folder for saving the results of cell type identification.</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="scrna-seq-pipeline.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step4. Identify cell types automatically.&#39;</span>)</span>
<span id="cb29-2"><a href="scrna-seq-pipeline.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>))) {</span>
<span id="cb29-3"><a href="scrna-seq-pipeline.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>))</span>
<span id="cb29-4"><a href="scrna-seq-pipeline.html#cb29-4" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<ul>
<li>Run the cell type identification process and the copy number variation (CNV) analysis.</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="scrna-seq-pipeline.html#cb30-1" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">run_cell_annotation</span>(<span class="at">object =</span> sc_object, </span>
<span id="cb30-2"><a href="scrna-seq-pipeline.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">assay =</span> <span class="st">&#39;RNA&#39;</span>, </span>
<span id="cb30-3"><a href="scrna-seq-pipeline.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">species =</span> Org,</span>
<span id="cb30-4"><a href="scrna-seq-pipeline.html#cb30-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>))</span>
<span id="cb30-5"><a href="scrna-seq-pipeline.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="scrna-seq-pipeline.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Org <span class="sc">==</span> <span class="st">&#39;hsa&#39;</span>){</span>
<span id="cb30-7"><a href="scrna-seq-pipeline.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">paste0</span>(databasePath,<span class="st">&quot;/HematoMap.reference.rdata&quot;</span>))</span>
<span id="cb30-8"><a href="scrna-seq-pipeline.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(<span class="fu">rownames</span>(HematoMap.reference), <span class="fu">rownames</span>(sc_object))) <span class="sc">&lt;</span> <span class="dv">1000</span>){</span>
<span id="cb30-9"><a href="scrna-seq-pipeline.html#cb30-9" aria-hidden="true" tabindex="-1"></a>      HematoMap.reference <span class="ot">&lt;-</span> <span class="fu">RenameGenesSeurat</span>(<span class="at">obj =</span> HematoMap.reference,</span>
<span id="cb30-10"><a href="scrna-seq-pipeline.html#cb30-10" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">newnames =</span> <span class="fu">toupper</span>(<span class="fu">rownames</span>(HematoMap.reference)),</span>
<span id="cb30-11"><a href="scrna-seq-pipeline.html#cb30-11" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">gene.use =</span> <span class="fu">rownames</span>(HematoMap.reference), </span>
<span id="cb30-12"><a href="scrna-seq-pipeline.html#cb30-12" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">de.assay =</span> <span class="st">&quot;RNA&quot;</span>,</span>
<span id="cb30-13"><a href="scrna-seq-pipeline.html#cb30-13" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">lassays =</span> <span class="st">&quot;RNA&quot;</span>)</span>
<span id="cb30-14"><a href="scrna-seq-pipeline.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-15"><a href="scrna-seq-pipeline.html#cb30-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-16"><a href="scrna-seq-pipeline.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(sc_object<span class="sc">@</span>active.assay <span class="sc">==</span> <span class="st">&#39;integrated&#39;</span>){</span>
<span id="cb30-17"><a href="scrna-seq-pipeline.html#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span></span>
<span id="cb30-18"><a href="scrna-seq-pipeline.html#cb30-18" aria-hidden="true" tabindex="-1"></a>    sc_object <span class="ot">&lt;-</span> <span class="fu">mapDataToRef</span>(<span class="at">ref_object =</span> HematoMap.reference,</span>
<span id="cb30-19"><a href="scrna-seq-pipeline.html#cb30-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ref_labels =</span> HematoMap.reference<span class="sc">@</span>meta.data<span class="sc">$</span>CellType,</span>
<span id="cb30-20"><a href="scrna-seq-pipeline.html#cb30-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">query_object =</span> sc_object,</span>
<span id="cb30-21"><a href="scrna-seq-pipeline.html#cb30-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">PCs =</span> PCs,</span>
<span id="cb30-22"><a href="scrna-seq-pipeline.html#cb30-22" aria-hidden="true" tabindex="-1"></a>                              <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>))</span>
<span id="cb30-23"><a href="scrna-seq-pipeline.html#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;integrated&#39;</span></span>
<span id="cb30-24"><a href="scrna-seq-pipeline.html#cb30-24" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb30-25"><a href="scrna-seq-pipeline.html#cb30-25" aria-hidden="true" tabindex="-1"></a>    sc_object <span class="ot">&lt;-</span> <span class="fu">mapDataToRef</span>(<span class="at">ref_object =</span> HematoMap.reference,</span>
<span id="cb30-26"><a href="scrna-seq-pipeline.html#cb30-26" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ref_labels =</span> HematoMap.reference<span class="sc">@</span>meta.data<span class="sc">$</span>CellType,</span>
<span id="cb30-27"><a href="scrna-seq-pipeline.html#cb30-27" aria-hidden="true" tabindex="-1"></a>                              <span class="at">query_object =</span> sc_object,</span>
<span id="cb30-28"><a href="scrna-seq-pipeline.html#cb30-28" aria-hidden="true" tabindex="-1"></a>                              <span class="at">PCs =</span> PCs,</span>
<span id="cb30-29"><a href="scrna-seq-pipeline.html#cb30-29" aria-hidden="true" tabindex="-1"></a>                              <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>))</span>
<span id="cb30-30"><a href="scrna-seq-pipeline.html#cb30-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-31"><a href="scrna-seq-pipeline.html#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="scrna-seq-pipeline.html#cb30-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Set the cell labels.</li>
</ul>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="scrna-seq-pipeline.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the cell labels</span></span>
<span id="cb31-2"><a href="scrna-seq-pipeline.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;clustering&#39;</span>){</span>
<span id="cb31-3"><a href="scrna-seq-pipeline.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>seurat_clusters</span>
<span id="cb31-4"><a href="scrna-seq-pipeline.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels</span>
<span id="cb31-5"><a href="scrna-seq-pipeline.html#cb31-5" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;abcCellmap.1&#39;</span>){</span>
<span id="cb31-6"><a href="scrna-seq-pipeline.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>Seurat.RNACluster</span>
<span id="cb31-7"><a href="scrna-seq-pipeline.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels</span>
<span id="cb31-8"><a href="scrna-seq-pipeline.html#cb31-8" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;abcCellmap.2&#39;</span>){</span>
<span id="cb31-9"><a href="scrna-seq-pipeline.html#cb31-9" aria-hidden="true" tabindex="-1"></a>  sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>scmap.RNACluster</span>
<span id="cb31-10"><a href="scrna-seq-pipeline.html#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels</span>
<span id="cb31-11"><a href="scrna-seq-pipeline.html#cb31-11" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;abcCellmap.3&#39;</span>){</span>
<span id="cb31-12"><a href="scrna-seq-pipeline.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>Seurat.Immunophenotype</span>
<span id="cb31-13"><a href="scrna-seq-pipeline.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels          </span>
<span id="cb31-14"><a href="scrna-seq-pipeline.html#cb31-14" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;abcCellmap.4&#39;</span>){</span>
<span id="cb31-15"><a href="scrna-seq-pipeline.html#cb31-15" aria-hidden="true" tabindex="-1"></a>  sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>scmap.Immunophenotype</span>
<span id="cb31-16"><a href="scrna-seq-pipeline.html#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels          </span>
<span id="cb31-17"><a href="scrna-seq-pipeline.html#cb31-17" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;HematoMap&#39;</span>){</span>
<span id="cb31-18"><a href="scrna-seq-pipeline.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(Org <span class="sc">==</span> <span class="st">&#39;hsa&#39;</span>){</span>
<span id="cb31-19"><a href="scrna-seq-pipeline.html#cb31-19" aria-hidden="true" tabindex="-1"></a>    sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>predicted.id</span>
<span id="cb31-20"><a href="scrna-seq-pipeline.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels</span>
<span id="cb31-21"><a href="scrna-seq-pipeline.html#cb31-21" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&quot;&#39;HematoMap&#39; is only applicable to human data (&#39;Org&#39; = &#39;hsa&#39;).&quot;</span>)}    </span>
<span id="cb31-22"><a href="scrna-seq-pipeline.html#cb31-22" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Step4_Use_Which_Labels <span class="sc">==</span> <span class="st">&#39;changeLabels&#39;</span>){</span>
<span id="cb31-23"><a href="scrna-seq-pipeline.html#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(Step4_Cluster_Labels) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(Step4_Changed_Labels) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(Step4_Cluster_Labels) <span class="sc">==</span> <span class="fu">length</span>(Step4_Changed_Labels)){</span>
<span id="cb31-24"><a href="scrna-seq-pipeline.html#cb31-24" aria-hidden="true" tabindex="-1"></a>   sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">mapvalues</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>seurat_clusters,</span>
<span id="cb31-25"><a href="scrna-seq-pipeline.html#cb31-25" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">from =</span> <span class="fu">as.character</span>(Step4_Cluster_Labels),</span>
<span id="cb31-26"><a href="scrna-seq-pipeline.html#cb31-26" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">to =</span> <span class="fu">as.character</span>(Step4_Changed_Labels),</span>
<span id="cb31-27"><a href="scrna-seq-pipeline.html#cb31-27" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">warn_missing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-28"><a href="scrna-seq-pipeline.html#cb31-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">Idents</span>(sc_object) <span class="ot">&lt;-</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels</span>
<span id="cb31-29"><a href="scrna-seq-pipeline.html#cb31-29" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb31-30"><a href="scrna-seq-pipeline.html#cb31-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">&quot;Please input the &#39;Step4_Cluster_Labels&#39; parameter as Seurat clustering labels, and the &#39;Step4_Changed_Labels&#39; parameter as new labels. Please note that these two parameters should be of equal length.&quot;</span>)</span>
<span id="cb31-31"><a href="scrna-seq-pipeline.html#cb31-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-32"><a href="scrna-seq-pipeline.html#cb31-32" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb31-33"><a href="scrna-seq-pipeline.html#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;Please set the &quot;Step4_Use_Which_Labels&quot; parameter as &quot;clustering&quot;, &quot;abcCellmap.1&quot;, &quot;abcCellmap.2&quot;, &quot;HematoMap&quot; or &quot;changeLabels&quot;.&#39;</span>)</span>
<span id="cb31-34"><a href="scrna-seq-pipeline.html#cb31-34" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="scrna-seq-pipeline.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb32-2"><a href="scrna-seq-pipeline.html#cb32-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb32-3"><a href="scrna-seq-pipeline.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb32-4"><a href="scrna-seq-pipeline.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb32-5"><a href="scrna-seq-pipeline.html#cb32-5" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb32-6"><a href="scrna-seq-pipeline.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb32-7"><a href="scrna-seq-pipeline.html#cb32-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<ul>
<li>Run the CNV analysis.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="scrna-seq-pipeline.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sc_CNV</span>(<span class="at">sc_object=</span>sc_object,</span>
<span id="cb33-2"><a href="scrna-seq-pipeline.html#cb33-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">save_path=</span><span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step4.Identify_Cell_Types/&#39;</span>),</span>
<span id="cb33-3"><a href="scrna-seq-pipeline.html#cb33-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">assay =</span> <span class="st">&#39;RNA&#39;</span>,</span>
<span id="cb33-4"><a href="scrna-seq-pipeline.html#cb33-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">LOW.DR =</span> <span class="fl">0.05</span>,</span>
<span id="cb33-5"><a href="scrna-seq-pipeline.html#cb33-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">UP.DR =</span> <span class="fl">0.1</span>,</span>
<span id="cb33-6"><a href="scrna-seq-pipeline.html#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">win.size =</span> <span class="dv">25</span>,</span>
<span id="cb33-7"><a href="scrna-seq-pipeline.html#cb33-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">distance =</span> <span class="st">&quot;euclidean&quot;</span>,</span>
<span id="cb33-8"><a href="scrna-seq-pipeline.html#cb33-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">genome =</span> <span class="cn">NULL</span>,</span>
<span id="cb33-9"><a href="scrna-seq-pipeline.html#cb33-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">n.cores =</span> ncores,</span>
<span id="cb33-10"><a href="scrna-seq-pipeline.html#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">species =</span> Org)</span></code></pre></div>
</div>
<div id="step-5.-visualization" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Step 5. Visualization<a href="scrna-seq-pipeline.html#step-5.-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the visualization results.</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="scrna-seq-pipeline.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step5. Visualization.&#39;</span>)</span>
<span id="cb34-2"><a href="scrna-seq-pipeline.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step5.Visualization/&#39;</span>))) {</span>
<span id="cb34-3"><a href="scrna-seq-pipeline.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step5.Visualization/&#39;</span>))</span>
<span id="cb34-4"><a href="scrna-seq-pipeline.html#cb34-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>The statistical results for the numbers and proportions of cell groups.</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="scrna-seq-pipeline.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># statistical results</span></span>
<span id="cb35-2"><a href="scrna-seq-pipeline.html#cb35-2" aria-hidden="true" tabindex="-1"></a>cells_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">rownames</span>(sc_object<span class="sc">@</span>meta.data), <span class="fu">as.character</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)))</span>
<span id="cb35-3"><a href="scrna-seq-pipeline.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cells_labels) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;cell_id&#39;</span>, <span class="st">&#39;cluster_id&#39;</span>)</span>
<span id="cb35-4"><a href="scrna-seq-pipeline.html#cb35-4" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> cells_labels <span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="scrna-seq-pipeline.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster_id) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="scrna-seq-pipeline.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>())</span>
<span id="cb35-7"><a href="scrna-seq-pipeline.html#cb35-7" aria-hidden="true" tabindex="-1"></a>total_cells <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cells_labels)</span>
<span id="cb35-8"><a href="scrna-seq-pipeline.html#cb35-8" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> cluster_counts <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="scrna-seq-pipeline.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> count <span class="sc">/</span> total_cells)</span>
<span id="cb35-10"><a href="scrna-seq-pipeline.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="scrna-seq-pipeline.html#cb35-11" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(cluster_counts)</span>
<span id="cb35-12"><a href="scrna-seq-pipeline.html#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="scrna-seq-pipeline.html#cb35-13" aria-hidden="true" tabindex="-1"></a>cluster_counts<span class="sc">$</span>percentages <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">percent</span>(cluster_counts<span class="sc">$</span>proportion, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb35-14"><a href="scrna-seq-pipeline.html#cb35-14" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> cluster_counts[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(cluster_counts)<span class="sc">==</span><span class="st">&#39;proportion&#39;</span>)]</span>
<span id="cb35-15"><a href="scrna-seq-pipeline.html#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="scrna-seq-pipeline.html#cb35-16" aria-hidden="true" tabindex="-1"></a>cluster_counts<span class="sc">$</span>cluster_id_count_percentages <span class="ot">&lt;-</span> <span class="fu">paste</span>(cluster_counts<span class="sc">$</span>cluster_id, <span class="st">&quot; (&quot;</span>, cluster_counts<span class="sc">$</span>count, <span class="st">&#39; cells; &#39;</span>, cluster_counts<span class="sc">$</span>percentages, <span class="st">&quot;)&quot;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb35-17"><a href="scrna-seq-pipeline.html#cb35-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-18"><a href="scrna-seq-pipeline.html#cb35-18" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> cluster_counts[<span class="fu">order</span>(cluster_counts<span class="sc">$</span>count, <span class="at">decreasing =</span> <span class="cn">TRUE</span>),]</span>
<span id="cb35-19"><a href="scrna-seq-pipeline.html#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="scrna-seq-pipeline.html#cb35-20" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cluster_counts, <span class="fu">c</span>(<span class="st">&#39;Total&#39;</span>, <span class="fu">sum</span>(cluster_counts<span class="sc">$</span>count), <span class="st">&#39;100%&#39;</span>, <span class="st">&#39;all cells&#39;</span>))</span>
<span id="cb35-21"><a href="scrna-seq-pipeline.html#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="scrna-seq-pipeline.html#cb35-22" aria-hidden="true" tabindex="-1"></a>sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>cluster_id_count_percentages <span class="ot">&lt;-</span> <span class="fu">mapvalues</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels, </span>
<span id="cb35-23"><a href="scrna-seq-pipeline.html#cb35-23" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">from=</span>cluster_counts<span class="sc">$</span>cluster_id, </span>
<span id="cb35-24"><a href="scrna-seq-pipeline.html#cb35-24" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">to=</span>cluster_counts<span class="sc">$</span>cluster_id_count_percentages,</span>
<span id="cb35-25"><a href="scrna-seq-pipeline.html#cb35-25" aria-hidden="true" tabindex="-1"></a>                                                              <span class="at">warn_missing=</span><span class="cn">FALSE</span>)</span>
<span id="cb35-26"><a href="scrna-seq-pipeline.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="scrna-seq-pipeline.html#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sc_object<span class="sc">@</span>meta.data)[<span class="fu">which</span>(<span class="fu">colnames</span>(sc_object<span class="sc">@</span>meta.data) <span class="sc">==</span> <span class="st">&#39;cluster_id_count_percentages&#39;</span>)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&#39;Total &#39;</span>, <span class="fu">nrow</span>(sc_object<span class="sc">@</span>meta.data), <span class="st">&#39; cells&#39;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>)</span>
<span id="cb35-28"><a href="scrna-seq-pipeline.html#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="scrna-seq-pipeline.html#cb35-29" aria-hidden="true" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> cluster_counts[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(cluster_counts)<span class="sc">==</span><span class="st">&#39;cluster_id_count_percentages&#39;</span>)]</span>
<span id="cb35-30"><a href="scrna-seq-pipeline.html#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="scrna-seq-pipeline.html#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cluster_counts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Cell types&#39;</span>, <span class="st">&#39;Cell counts&#39;</span>, <span class="st">&#39;Percentages&#39;</span>)</span>
<span id="cb35-32"><a href="scrna-seq-pipeline.html#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="scrna-seq-pipeline.html#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="co"># names(colorvector) &lt;- mapvalues(names(colorvector), </span></span>
<span id="cb35-34"><a href="scrna-seq-pipeline.html#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 from=cluster_counts$cluster_id, </span></span>
<span id="cb35-35"><a href="scrna-seq-pipeline.html#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 to=cluster_counts$cluster_id_count_percentages,</span></span>
<span id="cb35-36"><a href="scrna-seq-pipeline.html#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 warn_missing=FALSE)</span></span>
<span id="cb35-37"><a href="scrna-seq-pipeline.html#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="scrna-seq-pipeline.html#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(cluster_counts, <span class="at">file=</span><span class="fu">paste</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/cell types_cell counts_percentages.csv&#39;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>), <span class="at">quote=</span><span class="cn">FALSE</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<ul>
<li>The UMAP visualization.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="scrna-seq-pipeline.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/cell types_cell counts_percentages_umap.pdf&#39;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>), <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb36-2"><a href="scrna-seq-pipeline.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, </span>
<span id="cb36-3"><a href="scrna-seq-pipeline.html#cb36-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, </span>
<span id="cb36-4"><a href="scrna-seq-pipeline.html#cb36-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">group.by =</span> <span class="fu">paste</span>(<span class="st">&#39;Total &#39;</span>, <span class="fu">nrow</span>(sc_object<span class="sc">@</span>meta.data), <span class="st">&#39; cells&#39;</span>, <span class="at">sep=</span><span class="st">&#39;&#39;</span>), </span>
<span id="cb36-5"><a href="scrna-seq-pipeline.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="cn">FALSE</span>, </span>
<span id="cb36-6"><a href="scrna-seq-pipeline.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">pt.size =</span> <span class="fl">0.1</span>, </span>
<span id="cb36-7"><a href="scrna-seq-pipeline.html#cb36-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb36-8"><a href="scrna-seq-pipeline.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<ul>
<li>Set the parameters for phateR.</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="scrna-seq-pipeline.html#cb37-1" aria-hidden="true" tabindex="-1"></a>phate.knn <span class="ot">=</span> <span class="dv">50</span></span>
<span id="cb37-2"><a href="scrna-seq-pipeline.html#cb37-2" aria-hidden="true" tabindex="-1"></a>phate.npca <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb37-3"><a href="scrna-seq-pipeline.html#cb37-3" aria-hidden="true" tabindex="-1"></a>phate.t <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb37-4"><a href="scrna-seq-pipeline.html#cb37-4" aria-hidden="true" tabindex="-1"></a>phate.ndim <span class="ot">=</span> <span class="dv">2</span></span></code></pre></div>
<ul>
<li>Run phateR for dimensional reduction and visualization.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="scrna-seq-pipeline.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run phateR</span></span>
<span id="cb38-2"><a href="scrna-seq-pipeline.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( (<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&amp;</span> Step2_Quality_Control.RemoveBatches ){</span>
<span id="cb38-3"><a href="scrna-seq-pipeline.html#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;integrated&#39;</span></span>
<span id="cb38-4"><a href="scrna-seq-pipeline.html#cb38-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb38-5"><a href="scrna-seq-pipeline.html#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span>}</span>
<span id="cb38-6"><a href="scrna-seq-pipeline.html#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="scrna-seq-pipeline.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(pythonPath)){</span>
<span id="cb38-8"><a href="scrna-seq-pipeline.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_phateR</span>(<span class="at">sc_object =</span> sc_object,</span>
<span id="cb38-9"><a href="scrna-seq-pipeline.html#cb38-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step5.Visualization/&#39;</span>),</span>
<span id="cb38-10"><a href="scrna-seq-pipeline.html#cb38-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">pythonPath =</span> pythonPath,</span>
<span id="cb38-11"><a href="scrna-seq-pipeline.html#cb38-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">phate.knn =</span> phate.knn,</span>
<span id="cb38-12"><a href="scrna-seq-pipeline.html#cb38-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">phate.npca =</span> phate.npca,</span>
<span id="cb38-13"><a href="scrna-seq-pipeline.html#cb38-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">phate.t =</span> phate.t,</span>
<span id="cb38-14"><a href="scrna-seq-pipeline.html#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">phate.ndim =</span> phate.ndim)     </span>
<span id="cb38-15"><a href="scrna-seq-pipeline.html#cb38-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Perform visualization using UMAP and TSNE.</li>
</ul>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="scrna-seq-pipeline.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot cell types</span></span>
<span id="cb39-2"><a href="scrna-seq-pipeline.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;tsne cell types.pdf&#39;</span>), <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb39-3"><a href="scrna-seq-pipeline.html#cb39-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;tsne&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;ident&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb39-4"><a href="scrna-seq-pipeline.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb39-5"><a href="scrna-seq-pipeline.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="scrna-seq-pipeline.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;umap cell types.pdf&#39;</span>), <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>)</span>
<span id="cb39-7"><a href="scrna-seq-pipeline.html#cb39-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;ident&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb39-8"><a href="scrna-seq-pipeline.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb39-9"><a href="scrna-seq-pipeline.html#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="scrna-seq-pipeline.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;tsne cell types.png&#39;</span>), <span class="at">width =</span> <span class="dv">600</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb39-11"><a href="scrna-seq-pipeline.html#cb39-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;tsne&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;ident&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb39-12"><a href="scrna-seq-pipeline.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb39-13"><a href="scrna-seq-pipeline.html#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="scrna-seq-pipeline.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir,<span class="st">&#39;/Step5.Visualization/&#39;</span>), <span class="st">&#39;/sc_object &#39;</span>,<span class="st">&#39;umap cell types.png&#39;</span>), <span class="at">width =</span> <span class="dv">600</span>, <span class="at">height =</span> <span class="dv">600</span>)</span>
<span id="cb39-15"><a href="scrna-seq-pipeline.html#cb39-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">DimPlot</span>(sc_object, <span class="at">reduction =</span> <span class="st">&quot;umap&quot;</span>, <span class="at">group.by =</span> <span class="st">&quot;ident&quot;</span>, <span class="at">label =</span> <span class="cn">FALSE</span>, <span class="at">pt.size =</span> <span class="fl">0.1</span>, <span class="at">raster =</span> <span class="cn">FALSE</span>))</span>
<span id="cb39-16"><a href="scrna-seq-pipeline.html#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()    </span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="scrna-seq-pipeline.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb40-2"><a href="scrna-seq-pipeline.html#cb40-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb40-3"><a href="scrna-seq-pipeline.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb40-4"><a href="scrna-seq-pipeline.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb40-5"><a href="scrna-seq-pipeline.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb40-6"><a href="scrna-seq-pipeline.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb40-7"><a href="scrna-seq-pipeline.html#cb40-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-6.-find-degs" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Step 6. Find DEGs<a href="scrna-seq-pipeline.html#step-6.-find-degs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Set the parameters for identifying differentially expressed genes.</li>
</ul>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="scrna-seq-pipeline.html#cb41-1" aria-hidden="true" tabindex="-1"></a>min.pct <span class="ot">=</span> <span class="fl">0.25</span></span>
<span id="cb41-2"><a href="scrna-seq-pipeline.html#cb41-2" aria-hidden="true" tabindex="-1"></a>logfc.threshold <span class="ot">=</span> <span class="fl">0.25</span></span></code></pre></div>
<ul>
<li>Create a folder for the DEGs analysis.</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="scrna-seq-pipeline.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step6. Find DEGs.&#39;</span>)</span>
<span id="cb42-2"><a href="scrna-seq-pipeline.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>))) {</span>
<span id="cb42-3"><a href="scrna-seq-pipeline.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>))</span>
<span id="cb42-4"><a href="scrna-seq-pipeline.html#cb42-4" aria-hidden="true" tabindex="-1"></a>}   </span></code></pre></div>
<ul>
<li>Identify DEGs using Wilcoxon Rank-Sum Test.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="scrna-seq-pipeline.html#cb43-1" aria-hidden="true" tabindex="-1"></a>sc_object.markers <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(sc_object, <span class="at">only.pos =</span> <span class="cn">TRUE</span>, <span class="at">min.pct =</span> min.pct, <span class="at">logfc.threshold =</span> logfc.threshold)</span>
<span id="cb43-2"><a href="scrna-seq-pipeline.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(sc_object.markers,</span>
<span id="cb43-3"><a href="scrna-seq-pipeline.html#cb43-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>),<span class="st">&#39;sc_object.markerGenes.csv&#39;</span>),</span>
<span id="cb43-4"><a href="scrna-seq-pipeline.html#cb43-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">quote=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<ul>
<li>Set the parameters for GPTCelltype.</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="scrna-seq-pipeline.html#cb44-1" aria-hidden="true" tabindex="-1"></a>your_openai_API_key <span class="ot">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb44-2"><a href="scrna-seq-pipeline.html#cb44-2" aria-hidden="true" tabindex="-1"></a>tissuename <span class="ot">=</span> <span class="st">&#39;human bone marrow&#39;</span></span>
<span id="cb44-3"><a href="scrna-seq-pipeline.html#cb44-3" aria-hidden="true" tabindex="-1"></a>gptmodel <span class="ot">=</span> <span class="st">&#39;gpt-3.5&#39;</span></span></code></pre></div>
<ul>
<li>Use GPTCelltype to assist cell type annotation.</li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="scrna-seq-pipeline.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">GPT_annotation</span>( <span class="at">marker.genes =</span> sc_object.markers,</span>
<span id="cb45-2"><a href="scrna-seq-pipeline.html#cb45-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">your_openai_API_key =</span> your_openai_API_key,</span>
<span id="cb45-3"><a href="scrna-seq-pipeline.html#cb45-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">tissuename =</span> tissuename,</span>
<span id="cb45-4"><a href="scrna-seq-pipeline.html#cb45-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">gptmodel =</span> gptmodel,</span>
<span id="cb45-5"><a href="scrna-seq-pipeline.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>))</span></code></pre></div>
<ul>
<li>Perform GO and KEGG enrichment.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="scrna-seq-pipeline.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GO enrichment</span></span>
<span id="cb46-2"><a href="scrna-seq-pipeline.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Org<span class="sc">==</span><span class="st">&#39;mmu&#39;</span>){</span>
<span id="cb46-3"><a href="scrna-seq-pipeline.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  OrgDb <span class="ot">&lt;-</span> <span class="st">&#39;org.Mm.eg.db&#39;</span></span>
<span id="cb46-4"><a href="scrna-seq-pipeline.html#cb46-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Org<span class="sc">==</span><span class="st">&#39;hsa&#39;</span>){</span>
<span id="cb46-5"><a href="scrna-seq-pipeline.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  OrgDb <span class="ot">&lt;-</span> <span class="st">&#39;org.Hs.eg.db&#39;</span></span>
<span id="cb46-6"><a href="scrna-seq-pipeline.html#cb46-6" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb46-7"><a href="scrna-seq-pipeline.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Org should be &#39;mmu&#39; or &#39;hsa&#39;.&quot;</span>)</span>
<span id="cb46-8"><a href="scrna-seq-pipeline.html#cb46-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-9"><a href="scrna-seq-pipeline.html#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="scrna-seq-pipeline.html#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="fu">HemaScopeREnrichment</span>(<span class="at">DEGs=</span>sc_object.markers,</span>
<span id="cb46-11"><a href="scrna-seq-pipeline.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">OrgDb=</span>OrgDb,</span>
<span id="cb46-12"><a href="scrna-seq-pipeline.html#cb46-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">output.dir=</span><span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>))</span>
<span id="cb46-13"><a href="scrna-seq-pipeline.html#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="scrna-seq-pipeline.html#cb46-14" aria-hidden="true" tabindex="-1"></a>sc_object.markers.top5 <span class="ot">&lt;-</span> sc_object.markers <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">top_n</span>(<span class="at">n =</span> <span class="dv">5</span>, <span class="at">wt =</span> avg_log2FC)</span>
<span id="cb46-15"><a href="scrna-seq-pipeline.html#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="scrna-seq-pipeline.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>), <span class="st">&#39;sc_object_markerGenesTop5.pdf&#39;</span>), </span>
<span id="cb46-17"><a href="scrna-seq-pipeline.html#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">unique</span>(sc_object.markers.top5<span class="sc">$</span>gene)), </span>
<span id="cb46-18"><a href="scrna-seq-pipeline.html#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">Idents</span>(sc_object))))</span>
<span id="cb46-19"><a href="scrna-seq-pipeline.html#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">DotPlot</span>(sc_object,</span>
<span id="cb46-20"><a href="scrna-seq-pipeline.html#cb46-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">unique</span>(sc_object.markers.top5<span class="sc">$</span>gene),</span>
<span id="cb46-21"><a href="scrna-seq-pipeline.html#cb46-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>,<span class="st">&#39;red&#39;</span>))<span class="sc">+</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)))</span>
<span id="cb46-22"><a href="scrna-seq-pipeline.html#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span>
<span id="cb46-23"><a href="scrna-seq-pipeline.html#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="scrna-seq-pipeline.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/&#39;</span>), <span class="st">&#39;sc_object_markerGenesTop5.png&#39;</span>), </span>
<span id="cb46-25"><a href="scrna-seq-pipeline.html#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">20</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">unique</span>(sc_object.markers.top5<span class="sc">$</span>gene)), </span>
<span id="cb46-26"><a href="scrna-seq-pipeline.html#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">30</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">Idents</span>(sc_object))))</span>
<span id="cb46-27"><a href="scrna-seq-pipeline.html#cb46-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">DotPlot</span>(sc_object,</span>
<span id="cb46-28"><a href="scrna-seq-pipeline.html#cb46-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">unique</span>(sc_object.markers.top5<span class="sc">$</span>gene),</span>
<span id="cb46-29"><a href="scrna-seq-pipeline.html#cb46-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;lightgrey&quot;</span>,<span class="st">&#39;red&#39;</span>))<span class="sc">+</span><span class="fu">theme</span>(<span class="at">axis.text.x =</span><span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>)))</span>
<span id="cb46-30"><a href="scrna-seq-pipeline.html#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()  </span></code></pre></div>
<ul>
<li>Create a folder for saving the results of gene network analysis.</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="scrna-seq-pipeline.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/OpenXGR/&#39;</span>))) {</span>
<span id="cb47-2"><a href="scrna-seq-pipeline.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/OpenXGR/&#39;</span>))</span>
<span id="cb47-3"><a href="scrna-seq-pipeline.html#cb47-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Perform gene network analysis.</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="scrna-seq-pipeline.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">OpenXGR_SAG</span>(<span class="at">sc_object.markers =</span> sc_object.markers,</span>
<span id="cb48-2"><a href="scrna-seq-pipeline.html#cb48-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step6.Find_DEGs/OpenXGR/&#39;</span>),</span>
<span id="cb48-3"><a href="scrna-seq-pipeline.html#cb48-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">subnet.size =</span> <span class="dv">10</span>)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="scrna-seq-pipeline.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb49-2"><a href="scrna-seq-pipeline.html#cb49-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb49-3"><a href="scrna-seq-pipeline.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb49-4"><a href="scrna-seq-pipeline.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb49-5"><a href="scrna-seq-pipeline.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb49-6"><a href="scrna-seq-pipeline.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb49-7"><a href="scrna-seq-pipeline.html#cb49-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-7.-assign-cell-cycles" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Step 7. Assign Cell Cycles<a href="scrna-seq-pipeline.html#step-7.-assign-cell-cycles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the results of cell cycle analysis.</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="scrna-seq-pipeline.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step7. Assign cell cycles.&#39;</span>)</span>
<span id="cb50-2"><a href="scrna-seq-pipeline.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step7.Assign_cell_cycles/&#39;</span>))) {</span>
<span id="cb50-3"><a href="scrna-seq-pipeline.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step7.Assign_cell_cycles/&#39;</span>))</span>
<span id="cb50-4"><a href="scrna-seq-pipeline.html#cb50-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Set the parameters for the cell cycle analysis.</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="scrna-seq-pipeline.html#cb51-1" aria-hidden="true" tabindex="-1"></a>cellcycleCutoff <span class="ot">=</span> <span class="cn">NULL</span></span></code></pre></div>
<ul>
<li>Run the cell cycle analysis.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="scrna-seq-pipeline.html#cb52-1" aria-hidden="true" tabindex="-1"></a>datasets.before.batch.removal <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>),<span class="st">&#39;datasets.before.batch.removal.rds&#39;</span>))  </span>
<span id="cb52-2"><a href="scrna-seq-pipeline.html#cb52-2" aria-hidden="true" tabindex="-1"></a>sc_object <span class="ot">&lt;-</span> <span class="fu">cellCycle</span>(<span class="at">sc_object=</span>sc_object,</span>
<span id="cb52-3"><a href="scrna-seq-pipeline.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">counts_matrix =</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> datasets.before.batch.removal, <span class="at">slot =</span> <span class="st">&quot;counts&quot;</span>)<span class="sc">%&gt;%</span><span class="fu">as.matrix</span>(),</span>
<span id="cb52-4"><a href="scrna-seq-pipeline.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data_matrix =</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> datasets.before.batch.removal, <span class="at">slot =</span> <span class="st">&quot;data&quot;</span>)<span class="sc">%&gt;%</span><span class="fu">as.matrix</span>(),</span>
<span id="cb52-5"><a href="scrna-seq-pipeline.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cellcycleCutoff =</span> cellcycleCutoff,</span>
<span id="cb52-6"><a href="scrna-seq-pipeline.html#cb52-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cellTypeOrders =</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels),</span>
<span id="cb52-7"><a href="scrna-seq-pipeline.html#cb52-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">output.dir=</span><span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step7.Assign_cell_cycles/&#39;</span>),</span>
<span id="cb52-8"><a href="scrna-seq-pipeline.html#cb52-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">databasePath =</span> databasePath,</span>
<span id="cb52-9"><a href="scrna-seq-pipeline.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Org =</span> Org)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="scrna-seq-pipeline.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb53-2"><a href="scrna-seq-pipeline.html#cb53-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb53-3"><a href="scrna-seq-pipeline.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb53-4"><a href="scrna-seq-pipeline.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb53-5"><a href="scrna-seq-pipeline.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb53-6"><a href="scrna-seq-pipeline.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb53-7"><a href="scrna-seq-pipeline.html#cb53-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-8.-calculate-heterogeneity" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Step 8. Calculate Heterogeneity<a href="scrna-seq-pipeline.html#step-8.-calculate-heterogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the results of heterogeneity calculation.</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="scrna-seq-pipeline.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step8. Calculate heterogeneity.&#39;</span>)</span>
<span id="cb54-2"><a href="scrna-seq-pipeline.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step8.Calculate_heterogeneity/&#39;</span>))) {</span>
<span id="cb54-3"><a href="scrna-seq-pipeline.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step8.Calculate_heterogeneity/&#39;</span>))</span>
<span id="cb54-4"><a href="scrna-seq-pipeline.html#cb54-4" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
<ul>
<li>Run heterogeneity calculation process.</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="scrna-seq-pipeline.html#cb55-1" aria-hidden="true" tabindex="-1"></a>expression_matrix <span class="ot">&lt;-</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> datasets.before.batch.removal, <span class="at">slot =</span> <span class="st">&quot;data&quot;</span>)<span class="sc">%&gt;%</span><span class="fu">as.matrix</span>()</span>
<span id="cb55-2"><a href="scrna-seq-pipeline.html#cb55-2" aria-hidden="true" tabindex="-1"></a>expression_matrix <span class="ot">&lt;-</span> expression_matrix[,<span class="fu">rownames</span>(sc_object<span class="sc">@</span>meta.data)]</span>
<span id="cb55-3"><a href="scrna-seq-pipeline.html#cb55-3" aria-hidden="true" tabindex="-1"></a>cell_types_groups <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb55-4"><a href="scrna-seq-pipeline.html#cb55-4" aria-hidden="true" tabindex="-1"></a>                                         sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID))</span>
<span id="cb55-5"><a href="scrna-seq-pipeline.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cell_types_groups) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;clusters&#39;</span>, <span class="st">&#39;datasetID&#39;</span>)</span>
<span id="cb55-6"><a href="scrna-seq-pipeline.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="scrna-seq-pipeline.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(ViolinPlot.cellTypeOrders)){</span>
<span id="cb55-8"><a href="scrna-seq-pipeline.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)</span>
<span id="cb55-9"><a href="scrna-seq-pipeline.html#cb55-9" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb55-10"><a href="scrna-seq-pipeline.html#cb55-10" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> ViolinPlot.cellTypeOrders  </span>
<span id="cb55-11"><a href="scrna-seq-pipeline.html#cb55-11" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb55-12"><a href="scrna-seq-pipeline.html#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="scrna-seq-pipeline.html#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="fu">heterogeneity</span>(<span class="at">expression_matrix =</span> expression_matrix,</span>
<span id="cb55-14"><a href="scrna-seq-pipeline.html#cb55-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">cell_types_groups =</span> cell_types_groups,</span>
<span id="cb55-15"><a href="scrna-seq-pipeline.html#cb55-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">cellTypeOrders =</span> cellTypes_orders,</span>
<span id="cb55-16"><a href="scrna-seq-pipeline.html#cb55-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step8.Calculate_heterogeneity/&#39;</span>))</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="scrna-seq-pipeline.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb56-2"><a href="scrna-seq-pipeline.html#cb56-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb56-3"><a href="scrna-seq-pipeline.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb56-4"><a href="scrna-seq-pipeline.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb56-5"><a href="scrna-seq-pipeline.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb56-6"><a href="scrna-seq-pipeline.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb56-7"><a href="scrna-seq-pipeline.html#cb56-7" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="step-9.-violin-plot-for-marker-genes" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Step 9. Violin Plot for Marker Genes<a href="scrna-seq-pipeline.html#step-9.-violin-plot-for-marker-genes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the violin plots of marker genes.</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="scrna-seq-pipeline.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step9. Violin plot for marker genes.&#39;</span>)</span>
<span id="cb57-2"><a href="scrna-seq-pipeline.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step9.Violin_plot_for_marker_genes/&#39;</span>))) {</span>
<span id="cb57-3"><a href="scrna-seq-pipeline.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step9.Violin_plot_for_marker_genes/&#39;</span>))</span>
<span id="cb57-4"><a href="scrna-seq-pipeline.html#cb57-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run violin plot visualization.</li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="scrna-seq-pipeline.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( (<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&amp;</span> Step2_Quality_Control.RemoveBatches ){</span>
<span id="cb58-2"><a href="scrna-seq-pipeline.html#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;integrated&#39;</span></span>
<span id="cb58-3"><a href="scrna-seq-pipeline.html#cb58-3" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb58-4"><a href="scrna-seq-pipeline.html#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span>}</span>
<span id="cb58-5"><a href="scrna-seq-pipeline.html#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="scrna-seq-pipeline.html#cb58-6" aria-hidden="true" tabindex="-1"></a>dataMatrix <span class="ot">&lt;-</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> sc_object, <span class="at">slot =</span> <span class="st">&quot;scale.data&quot;</span>)</span>
<span id="cb58-7"><a href="scrna-seq-pipeline.html#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="scrna-seq-pipeline.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(marker.genes)<span class="sc">&amp;</span>(Org <span class="sc">==</span> <span class="st">&#39;mmu&#39;</span>)){</span>
<span id="cb58-9"><a href="scrna-seq-pipeline.html#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mpp genes are from &#39;The bone marrow microenvironment at single cell resolution&#39;</span></span>
<span id="cb58-10"><a href="scrna-seq-pipeline.html#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the other genes are from &#39;single cell characterization of haematopoietic progenitors and their trajectories in homeostasis and perturbed haematopoiesis&#39;</span></span>
<span id="cb58-11"><a href="scrna-seq-pipeline.html#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the aliases of these genes were changed in gecodeM16：Gpr64 -&gt; Adgrg2, Sdpr -&gt; Cavin2, Hbb-b1 -&gt; Hbb-bs, Sfpi1 -&gt; Spi1</span></span>
<span id="cb58-12"><a href="scrna-seq-pipeline.html#cb58-12" aria-hidden="true" tabindex="-1"></a>    HSC_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Slamf1&#39;</span>, <span class="st">&#39;Itga2b&#39;</span>, <span class="st">&#39;Kit&#39;</span>, <span class="st">&#39;Ly6a&#39;</span>, <span class="st">&#39;Bmi1&#39;</span>, <span class="st">&#39;Gata2&#39;</span>, <span class="st">&#39;Hlf&#39;</span>, <span class="st">&#39;Meis1&#39;</span>, <span class="st">&#39;Mpl&#39;</span>, <span class="st">&#39;Mcl1&#39;</span>, <span class="st">&#39;Gfi1&#39;</span>, <span class="st">&#39;Gfi1b&#39;</span>, <span class="st">&#39;Hoxb5&#39;</span>)</span>
<span id="cb58-13"><a href="scrna-seq-pipeline.html#cb58-13" aria-hidden="true" tabindex="-1"></a>    Mpp_genes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Mki67&#39;</span>, <span class="st">&#39;Mpo&#39;</span>, <span class="st">&#39;Elane&#39;</span>, <span class="st">&#39;Ctsg&#39;</span>, <span class="st">&#39;Calr&#39;</span>)</span>
<span id="cb58-14"><a href="scrna-seq-pipeline.html#cb58-14" aria-hidden="true" tabindex="-1"></a>    Erythroid_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Klf1&#39;</span>, <span class="st">&#39;Gata1&#39;</span>, <span class="st">&#39;Mpl&#39;</span>, <span class="st">&#39;Epor&#39;</span>, <span class="st">&#39;Vwf&#39;</span>, <span class="st">&#39;Zfpm1&#39;</span>, <span class="st">&#39;Fhl1&#39;</span>, <span class="st">&#39;Adgrg2&#39;</span>, <span class="st">&#39;Cavin2&#39;</span>,<span class="st">&#39;Gypa&#39;</span>, <span class="st">&#39;Tfrc&#39;</span>, <span class="st">&#39;Hbb-bs&#39;</span>, <span class="st">&#39;Hbb-y&#39;</span>)</span>
<span id="cb58-15"><a href="scrna-seq-pipeline.html#cb58-15" aria-hidden="true" tabindex="-1"></a>    Lymphoid_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Tcf3&#39;</span>, <span class="st">&#39;Ikzf1&#39;</span>, <span class="st">&#39;Notch1&#39;</span>, <span class="st">&#39;Flt3&#39;</span>, <span class="st">&#39;Dntt&#39;</span>, <span class="st">&#39;Btg2&#39;</span>, <span class="st">&#39;Tcf7&#39;</span>, <span class="st">&#39;Rag1&#39;</span>, <span class="st">&#39;Ptprc&#39;</span>, <span class="st">&#39;Ly6a&#39;</span>, <span class="st">&#39;Blnk&#39;</span>)</span>
<span id="cb58-16"><a href="scrna-seq-pipeline.html#cb58-16" aria-hidden="true" tabindex="-1"></a>    Myeloid_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;Gfi1&#39;</span>, <span class="st">&#39;Spi1&#39;</span>, <span class="st">&#39;Mpo&#39;</span>, <span class="st">&#39;Csf2rb&#39;</span>, <span class="st">&#39;Csf1r&#39;</span>, <span class="st">&#39;Gfi1b&#39;</span>, <span class="st">&#39;Hk3&#39;</span>, <span class="st">&#39;Csf2ra&#39;</span>, <span class="st">&#39;Csf3r&#39;</span>, <span class="st">&#39;Sp1&#39;</span>, <span class="st">&#39;Fcgr3&#39;</span>)</span>
<span id="cb58-17"><a href="scrna-seq-pipeline.html#cb58-17" aria-hidden="true" tabindex="-1"></a>    marker.genes <span class="ot">&lt;-</span> <span class="fu">c</span>(HSC_lineage_signatures, Mpp_genes, Erythroid_lineage_signatures, Lymphoid_lineage_signatures, Myeloid_lineage_signatures)</span>
<span id="cb58-18"><a href="scrna-seq-pipeline.html#cb58-18" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(marker.genes)<span class="sc">&amp;</span>(Org <span class="sc">==</span> <span class="st">&#39;hsa&#39;</span>)){</span>
<span id="cb58-19"><a href="scrna-seq-pipeline.html#cb58-19" aria-hidden="true" tabindex="-1"></a>    HSPCs_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;CD34&#39;</span>,<span class="st">&#39;KIT&#39;</span>,<span class="st">&#39;AVP&#39;</span>,<span class="st">&#39;FLT3&#39;</span>,<span class="st">&#39;MME&#39;</span>,<span class="st">&#39;CD7&#39;</span>,<span class="st">&#39;CD38&#39;</span>,<span class="st">&#39;CSF1R&#39;</span>,<span class="st">&#39;FCGR1A&#39;</span>,<span class="st">&#39;MPO&#39;</span>,<span class="st">&#39;ELANE&#39;</span>,<span class="st">&#39;IL3RA&#39;</span>)</span>
<span id="cb58-20"><a href="scrna-seq-pipeline.html#cb58-20" aria-hidden="true" tabindex="-1"></a>    Myeloids_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;LYZ&#39;</span>,<span class="st">&#39;CD36&#39;</span>,<span class="st">&#39;MPO&#39;</span>,<span class="st">&#39;FCGR1A&#39;</span>,<span class="st">&#39;CD4&#39;</span>,<span class="st">&#39;CD14&#39;</span>,<span class="st">&#39;CD300E&#39;</span>,<span class="st">&#39;ITGAX&#39;</span>,<span class="st">&#39;FCGR3A&#39;</span>,<span class="st">&#39;FLT3&#39;</span>,<span class="st">&#39;AXL&#39;</span>,</span>
<span id="cb58-21"><a href="scrna-seq-pipeline.html#cb58-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;SIGLEC6&#39;</span>,<span class="st">&#39;CLEC4C&#39;</span>,<span class="st">&#39;IRF4&#39;</span>,<span class="st">&#39;LILRA4&#39;</span>,<span class="st">&#39;IL3RA&#39;</span>,<span class="st">&#39;IRF8&#39;</span>,<span class="st">&#39;IRF7&#39;</span>,<span class="st">&#39;XCR1&#39;</span>,<span class="st">&#39;CD1C&#39;</span>,<span class="st">&#39;THBD&#39;</span>,</span>
<span id="cb58-22"><a href="scrna-seq-pipeline.html#cb58-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&#39;MRC1&#39;</span>,<span class="st">&#39;CD34&#39;</span>,<span class="st">&#39;KIT&#39;</span>,<span class="st">&#39;ITGA2B&#39;</span>,<span class="st">&#39;PF4&#39;</span>,<span class="st">&#39;CD9&#39;</span>,<span class="st">&#39;ENG&#39;</span>,<span class="st">&#39;KLF&#39;</span>,<span class="st">&#39;TFRC&#39;</span>)</span>
<span id="cb58-23"><a href="scrna-seq-pipeline.html#cb58-23" aria-hidden="true" tabindex="-1"></a>    B_cells_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;CD79A&#39;</span>,<span class="st">&#39;IGLL1&#39;</span>,<span class="st">&#39;RAG1&#39;</span>,<span class="st">&#39;RAG2&#39;</span>,<span class="st">&#39;VPREB1&#39;</span>,<span class="st">&#39;MME&#39;</span>,<span class="st">&#39;IL7R&#39;</span>,<span class="st">&#39;DNTT&#39;</span>,<span class="st">&#39;MKI67&#39;</span>,<span class="st">&#39;PCNA&#39;</span>,<span class="st">&#39;TCL1A&#39;</span>,<span class="st">&#39;MS4A1&#39;</span>,<span class="st">&#39;IGHD&#39;</span>,<span class="st">&#39;CD27&#39;</span>,<span class="st">&#39;IGHG3&#39;</span>)</span>
<span id="cb58-24"><a href="scrna-seq-pipeline.html#cb58-24" aria-hidden="true" tabindex="-1"></a>    T_NK_cells_lineage_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;CD3D&#39;</span>,<span class="st">&#39;CD3E&#39;</span>,<span class="st">&#39;CD8A&#39;</span>,<span class="st">&#39;CCR7&#39;</span>,<span class="st">&#39;IL7R&#39;</span>,<span class="st">&#39;SELL&#39;</span>,<span class="st">&#39;KLRG1&#39;</span>,<span class="st">&#39;CD27&#39;</span>,<span class="st">&#39;GNLY&#39;</span>,</span>
<span id="cb58-25"><a href="scrna-seq-pipeline.html#cb58-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;NKG7&#39;</span>,<span class="st">&#39;PDCD1&#39;</span>,<span class="st">&#39;TNFRSF9&#39;</span>,<span class="st">&#39;LAG3&#39;</span>,<span class="st">&#39;CD160&#39;</span>,<span class="st">&#39;CD4&#39;</span>,<span class="st">&#39;CD40LG&#39;</span>,<span class="st">&#39;IL2RA&#39;</span>,</span>
<span id="cb58-26"><a href="scrna-seq-pipeline.html#cb58-26" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;FOXP3&#39;</span>,<span class="st">&#39;DUSP4&#39;</span>,<span class="st">&#39;IL2RB&#39;</span>,<span class="st">&#39;KLRF1&#39;</span>,<span class="st">&#39;FCGR3A&#39;</span>,<span class="st">&#39;NCAM1&#39;</span>,<span class="st">&#39;XCL1&#39;</span>,<span class="st">&#39;MKI67&#39;</span>,<span class="st">&#39;PCNA&#39;</span>,<span class="st">&#39;KLRF&#39;</span>)</span>
<span id="cb58-27"><a href="scrna-seq-pipeline.html#cb58-27" aria-hidden="true" tabindex="-1"></a>    marker.genes <span class="ot">&lt;-</span> <span class="fu">c</span>(HSPCs_lineage_signatures, Myeloids_lineage_signatures, B_cells_lineage_signatures, T_NK_cells_lineage_signatures)</span>
<span id="cb58-28"><a href="scrna-seq-pipeline.html#cb58-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-29"><a href="scrna-seq-pipeline.html#cb58-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-30"><a href="scrna-seq-pipeline.html#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(ViolinPlot.cellTypeOrders)){</span>
<span id="cb58-31"><a href="scrna-seq-pipeline.html#cb58-31" aria-hidden="true" tabindex="-1"></a>  ViolinPlot.cellTypeOrders <span class="ot">&lt;-</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)</span>
<span id="cb58-32"><a href="scrna-seq-pipeline.html#cb58-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-33"><a href="scrna-seq-pipeline.html#cb58-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-34"><a href="scrna-seq-pipeline.html#cb58-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(ViolinPlot.cellTypeColors)){</span>
<span id="cb58-35"><a href="scrna-seq-pipeline.html#cb58-35" aria-hidden="true" tabindex="-1"></a>  ViolinPlot.cellTypeColors <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="fu">length</span>(<span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)))</span>
<span id="cb58-36"><a href="scrna-seq-pipeline.html#cb58-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-37"><a href="scrna-seq-pipeline.html#cb58-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-38"><a href="scrna-seq-pipeline.html#cb58-38" aria-hidden="true" tabindex="-1"></a><span class="fu">combinedViolinPlot</span>(<span class="at">dataMatrix =</span> dataMatrix,</span>
<span id="cb58-39"><a href="scrna-seq-pipeline.html#cb58-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">features =</span> marker.genes,</span>
<span id="cb58-40"><a href="scrna-seq-pipeline.html#cb58-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">CellTypes =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb58-41"><a href="scrna-seq-pipeline.html#cb58-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cellTypeOrders =</span> ViolinPlot.cellTypeOrders,</span>
<span id="cb58-42"><a href="scrna-seq-pipeline.html#cb58-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cellTypeColors =</span> ViolinPlot.cellTypeColors,</span>
<span id="cb58-43"><a href="scrna-seq-pipeline.html#cb58-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Org =</span> Org,</span>
<span id="cb58-44"><a href="scrna-seq-pipeline.html#cb58-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step9.Violin_plot_for_marker_genes/&#39;</span>),</span>
<span id="cb58-45"><a href="scrna-seq-pipeline.html#cb58-45" aria-hidden="true" tabindex="-1"></a>                   <span class="at">databasePath =</span> databasePath)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="scrna-seq-pipeline.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb59-2"><a href="scrna-seq-pipeline.html#cb59-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb59-3"><a href="scrna-seq-pipeline.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb59-4"><a href="scrna-seq-pipeline.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb59-5"><a href="scrna-seq-pipeline.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb59-6"><a href="scrna-seq-pipeline.html#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb59-7"><a href="scrna-seq-pipeline.html#cb59-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-10.-calculate-lineage-scores" class="section level2 hasAnchor" number="3.11">
<h2><span class="header-section-number">3.11</span> Step 10. Calculate Lineage Scores<a href="scrna-seq-pipeline.html#step-10.-calculate-lineage-scores" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the results of lineage score calculation.</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="scrna-seq-pipeline.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step10. Calculate lineage scores.&#39;</span>)</span>
<span id="cb60-2"><a href="scrna-seq-pipeline.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we use normalized data here</span></span>
<span id="cb60-3"><a href="scrna-seq-pipeline.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step10.Calculate_lineage_scores/&#39;</span>))) {</span>
<span id="cb60-4"><a href="scrna-seq-pipeline.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step10.Calculate_lineage_scores/&#39;</span>))</span>
<span id="cb60-5"><a href="scrna-seq-pipeline.html#cb60-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run lineage score calculation.</li>
</ul>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="scrna-seq-pipeline.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(lineage.genelist)<span class="sc">&amp;</span><span class="fu">is.null</span>(lineage.names)<span class="sc">&amp;</span>(Org <span class="sc">==</span> <span class="st">&#39;mmu&#39;</span>)){</span>
<span id="cb61-2"><a href="scrna-seq-pipeline.html#cb61-2" aria-hidden="true" tabindex="-1"></a>    lineage.genelist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(HSC_lineage_signatures),</span>
<span id="cb61-3"><a href="scrna-seq-pipeline.html#cb61-3" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(Mpp_genes),</span>
<span id="cb61-4"><a href="scrna-seq-pipeline.html#cb61-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(Erythroid_lineage_signatures),</span>
<span id="cb61-5"><a href="scrna-seq-pipeline.html#cb61-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(Lymphoid_lineage_signatures),</span>
<span id="cb61-6"><a href="scrna-seq-pipeline.html#cb61-6" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(Myeloid_lineage_signatures))</span>
<span id="cb61-7"><a href="scrna-seq-pipeline.html#cb61-7" aria-hidden="true" tabindex="-1"></a>    lineage.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;HSC_lineage_signatures&#39;</span>,</span>
<span id="cb61-8"><a href="scrna-seq-pipeline.html#cb61-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Mpp_genes&#39;</span>,</span>
<span id="cb61-9"><a href="scrna-seq-pipeline.html#cb61-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Erythroid_lineage_signatures&#39;</span>,</span>
<span id="cb61-10"><a href="scrna-seq-pipeline.html#cb61-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Lymphoid_lineage_signatures&#39;</span>,</span>
<span id="cb61-11"><a href="scrna-seq-pipeline.html#cb61-11" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Myeloid_lineage_signatures&#39;</span>)</span>
<span id="cb61-12"><a href="scrna-seq-pipeline.html#cb61-12" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">is.null</span>(lineage.genelist)<span class="sc">&amp;</span><span class="fu">is.null</span>(lineage.names)<span class="sc">&amp;</span>(Org <span class="sc">==</span> <span class="st">&#39;hsa&#39;</span>)){</span>
<span id="cb61-13"><a href="scrna-seq-pipeline.html#cb61-13" aria-hidden="true" tabindex="-1"></a>    lineage.genelist <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(HSPCs_lineage_signatures),</span>
<span id="cb61-14"><a href="scrna-seq-pipeline.html#cb61-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(Myeloids_lineage_signatures),</span>
<span id="cb61-15"><a href="scrna-seq-pipeline.html#cb61-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(B_cells_lineage_signatures),</span>
<span id="cb61-16"><a href="scrna-seq-pipeline.html#cb61-16" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(T_NK_cells_lineage_signatures))</span>
<span id="cb61-17"><a href="scrna-seq-pipeline.html#cb61-17" aria-hidden="true" tabindex="-1"></a>    lineage.names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;HSPCs_lineage_signatures&#39;</span>,</span>
<span id="cb61-18"><a href="scrna-seq-pipeline.html#cb61-18" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;Myeloids_lineage_signatures&#39;</span>,</span>
<span id="cb61-19"><a href="scrna-seq-pipeline.html#cb61-19" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;B_cells_lineage_signatures&#39;</span>,</span>
<span id="cb61-20"><a href="scrna-seq-pipeline.html#cb61-20" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;T_NK_cells_lineage_signatures&#39;</span>) </span>
<span id="cb61-21"><a href="scrna-seq-pipeline.html#cb61-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-22"><a href="scrna-seq-pipeline.html#cb61-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-23"><a href="scrna-seq-pipeline.html#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(ViolinPlot.cellTypeOrders)){</span>
<span id="cb61-24"><a href="scrna-seq-pipeline.html#cb61-24" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)</span>
<span id="cb61-25"><a href="scrna-seq-pipeline.html#cb61-25" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb61-26"><a href="scrna-seq-pipeline.html#cb61-26" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> ViolinPlot.cellTypeOrders  </span>
<span id="cb61-27"><a href="scrna-seq-pipeline.html#cb61-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-28"><a href="scrna-seq-pipeline.html#cb61-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-29"><a href="scrna-seq-pipeline.html#cb61-29" aria-hidden="true" tabindex="-1"></a><span class="fu">lineageScores</span>(<span class="at">expression_matrix =</span> expression_matrix,</span>
<span id="cb61-30"><a href="scrna-seq-pipeline.html#cb61-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">cellTypes =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb61-31"><a href="scrna-seq-pipeline.html#cb61-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">cellTypes_orders =</span> cellTypes_orders,</span>
<span id="cb61-32"><a href="scrna-seq-pipeline.html#cb61-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">cellTypes_colors =</span> ViolinPlot.cellTypeColors,</span>
<span id="cb61-33"><a href="scrna-seq-pipeline.html#cb61-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">groups =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID,</span>
<span id="cb61-34"><a href="scrna-seq-pipeline.html#cb61-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">groups_orders =</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID),</span>
<span id="cb61-35"><a href="scrna-seq-pipeline.html#cb61-35" aria-hidden="true" tabindex="-1"></a>              <span class="at">groups_colors =</span> groups_colors,</span>
<span id="cb61-36"><a href="scrna-seq-pipeline.html#cb61-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">lineage.genelist =</span> lineage.genelist,</span>
<span id="cb61-37"><a href="scrna-seq-pipeline.html#cb61-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">lineage.names =</span> lineage.names,</span>
<span id="cb61-38"><a href="scrna-seq-pipeline.html#cb61-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">Org =</span> Org,</span>
<span id="cb61-39"><a href="scrna-seq-pipeline.html#cb61-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step10.Calculate_lineage_scores/&#39;</span>),</span>
<span id="cb61-40"><a href="scrna-seq-pipeline.html#cb61-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">databasePath =</span> databasePath)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="scrna-seq-pipeline.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb62-2"><a href="scrna-seq-pipeline.html#cb62-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb62-3"><a href="scrna-seq-pipeline.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb62-4"><a href="scrna-seq-pipeline.html#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb62-5"><a href="scrna-seq-pipeline.html#cb62-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb62-6"><a href="scrna-seq-pipeline.html#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb62-7"><a href="scrna-seq-pipeline.html#cb62-7" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
</div>
<div id="step-11.-gsva" class="section level2 hasAnchor" number="3.12">
<h2><span class="header-section-number">3.12</span> Step 11. GSVA<a href="scrna-seq-pipeline.html#step-11.-gsva" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create a folder for saving the results of GSVA.</li>
</ul>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="scrna-seq-pipeline.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step11. GSVA.&#39;</span>)</span>
<span id="cb63-2"><a href="scrna-seq-pipeline.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step11.GSVA/&#39;</span>))) {</span>
<span id="cb63-3"><a href="scrna-seq-pipeline.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step11.GSVA/&#39;</span>))</span>
<span id="cb63-4"><a href="scrna-seq-pipeline.html#cb63-4" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<ul>
<li>Run GSVA.</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="scrna-seq-pipeline.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wdir)</span>
<span id="cb64-2"><a href="scrna-seq-pipeline.html#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="scrna-seq-pipeline.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Org<span class="sc">==</span><span class="st">&#39;mmu&#39;</span>){</span>
<span id="cb64-4"><a href="scrna-seq-pipeline.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(databasePath,<span class="st">&quot;/mouse_c2_v5p2.rdata&quot;</span>))</span>
<span id="cb64-5"><a href="scrna-seq-pipeline.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  GSVA.genelist <span class="ot">&lt;-</span> Mm.c2</span>
<span id="cb64-6"><a href="scrna-seq-pipeline.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="st">&#39;OrgDB&#39;</span>, org.Mm.eg.db)</span>
<span id="cb64-7"><a href="scrna-seq-pipeline.html#cb64-7" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Org<span class="sc">==</span><span class="st">&#39;hsa&#39;</span>){</span>
<span id="cb64-8"><a href="scrna-seq-pipeline.html#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="fu">paste0</span>(databasePath,<span class="st">&quot;/human_c2_v5p2.rdata&quot;</span>))</span>
<span id="cb64-9"><a href="scrna-seq-pipeline.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  GSVA.genelist <span class="ot">&lt;-</span> Hs.c2</span>
<span id="cb64-10"><a href="scrna-seq-pipeline.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="st">&#39;OrgDB&#39;</span>, org.Hs.eg.db)</span>
<span id="cb64-11"><a href="scrna-seq-pipeline.html#cb64-11" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb64-12"><a href="scrna-seq-pipeline.html#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Org should be &#39;mmu&#39; or &#39;hsa&#39;.&quot;</span>)</span>
<span id="cb64-13"><a href="scrna-seq-pipeline.html#cb64-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-14"><a href="scrna-seq-pipeline.html#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="scrna-seq-pipeline.html#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(ViolinPlot.cellTypeOrders)){</span>
<span id="cb64-16"><a href="scrna-seq-pipeline.html#cb64-16" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels)</span>
<span id="cb64-17"><a href="scrna-seq-pipeline.html#cb64-17" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb64-18"><a href="scrna-seq-pipeline.html#cb64-18" aria-hidden="true" tabindex="-1"></a>  cellTypes_orders <span class="ot">&lt;-</span> ViolinPlot.cellTypeOrders  </span>
<span id="cb64-19"><a href="scrna-seq-pipeline.html#cb64-19" aria-hidden="true" tabindex="-1"></a>}    </span>
<span id="cb64-20"><a href="scrna-seq-pipeline.html#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="fu">run_GSVA</span>(<span class="at">sc_object =</span> sc_object,</span>
<span id="cb64-21"><a href="scrna-seq-pipeline.html#cb64-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.genelist =</span> GSVA.genelist,</span>
<span id="cb64-22"><a href="scrna-seq-pipeline.html#cb64-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.cellTypes =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb64-23"><a href="scrna-seq-pipeline.html#cb64-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.cellTypes.orders =</span> cellTypes_orders,</span>
<span id="cb64-24"><a href="scrna-seq-pipeline.html#cb64-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.cellGroups =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID,</span>
<span id="cb64-25"><a href="scrna-seq-pipeline.html#cb64-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.identify.cellType.features =</span> Step11_GSVA.identify.cellType.features,</span>
<span id="cb64-26"><a href="scrna-seq-pipeline.html#cb64-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.identify.diff.features =</span> Step11_GSVA.identify.diff.features,</span>
<span id="cb64-27"><a href="scrna-seq-pipeline.html#cb64-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">GSVA.comparison.design =</span> Step11_GSVA.comparison.design,</span>
<span id="cb64-28"><a href="scrna-seq-pipeline.html#cb64-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">OrgDB =</span> OrgDB,</span>
<span id="cb64-29"><a href="scrna-seq-pipeline.html#cb64-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step11.GSVA/&#39;</span>))</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="scrna-seq-pipeline.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb65-2"><a href="scrna-seq-pipeline.html#cb65-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb65-3"><a href="scrna-seq-pipeline.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb65-4"><a href="scrna-seq-pipeline.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb65-5"><a href="scrna-seq-pipeline.html#cb65-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb65-6"><a href="scrna-seq-pipeline.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb65-7"><a href="scrna-seq-pipeline.html#cb65-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>
</div>
<div id="step-12.-construct-trajectories" class="section level2 hasAnchor" number="3.13">
<h2><span class="header-section-number">3.13</span> Step 12. Construct Trajectories<a href="scrna-seq-pipeline.html#step-12.-construct-trajectories" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Load gene symbols and ensemble IDs.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="scrna-seq-pipeline.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(sc_object) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span></span>
<span id="cb66-2"><a href="scrna-seq-pipeline.html#cb66-2" aria-hidden="true" tabindex="-1"></a>countsSlot <span class="ot">&lt;-</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> sc_object, <span class="at">slot =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb66-3"><a href="scrna-seq-pipeline.html#cb66-3" aria-hidden="true" tabindex="-1"></a>gene_metadata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rownames</span>(countsSlot))</span>
<span id="cb66-4"><a href="scrna-seq-pipeline.html#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(gene_metadata) <span class="ot">&lt;-</span> gene_metadata[,<span class="dv">1</span>]        </span>
<span id="cb66-5"><a href="scrna-seq-pipeline.html#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(Org <span class="sc">==</span> <span class="st">&#39;mmu&#39;</span>){</span>
<span id="cb66-6"><a href="scrna-seq-pipeline.html#cb66-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">load</span>(<span class="fu">paste0</span>(databasePath,<span class="st">&quot;/mouseGeneSymbolandEnsembleID.rdata&quot;</span>))</span>
<span id="cb66-7"><a href="scrna-seq-pipeline.html#cb66-7" aria-hidden="true" tabindex="-1"></a>   gene_metadata <span class="sc">$</span> ensembleID <span class="ot">&lt;-</span> <span class="fu">mapvalues</span>(<span class="at">x =</span> gene_metadata[,<span class="dv">1</span>],</span>
<span id="cb66-8"><a href="scrna-seq-pipeline.html#cb66-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">from =</span> mouseGeneSymbolandEnsembleID<span class="sc">$</span>geneName,</span>
<span id="cb66-9"><a href="scrna-seq-pipeline.html#cb66-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">to =</span> mouseGeneSymbolandEnsembleID<span class="sc">$</span>ensemblIDNoDot,</span>
<span id="cb66-10"><a href="scrna-seq-pipeline.html#cb66-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">warn_missing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-11"><a href="scrna-seq-pipeline.html#cb66-11" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(Org <span class="sc">==</span> <span class="st">&#39;hsa&#39;</span>){</span>
<span id="cb66-12"><a href="scrna-seq-pipeline.html#cb66-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">load</span>(<span class="fu">paste0</span>(databasePath,<span class="st">&quot;/humanGeneSymbolandEnsembleID.rdata&quot;</span>))</span>
<span id="cb66-13"><a href="scrna-seq-pipeline.html#cb66-13" aria-hidden="true" tabindex="-1"></a>   gene_metadata <span class="sc">$</span> ensembleID <span class="ot">&lt;-</span> <span class="fu">mapvalues</span>(<span class="at">x =</span> gene_metadata[,<span class="dv">1</span>],</span>
<span id="cb66-14"><a href="scrna-seq-pipeline.html#cb66-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">from =</span> humanGeneSymbolandEnsembleID<span class="sc">$</span>geneName,</span>
<span id="cb66-15"><a href="scrna-seq-pipeline.html#cb66-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">to =</span> humanGeneSymbolandEnsembleID<span class="sc">$</span>ensemblIDNoDot,</span>
<span id="cb66-16"><a href="scrna-seq-pipeline.html#cb66-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">warn_missing =</span> <span class="cn">FALSE</span>) </span>
<span id="cb66-17"><a href="scrna-seq-pipeline.html#cb66-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-18"><a href="scrna-seq-pipeline.html#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gene_metadata) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;gene_short_name&#39;</span>,<span class="st">&#39;ensembleID&#39;</span>)</span></code></pre></div>
<ul>
<li>Create folders for saving the results of trajectory construction.</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="scrna-seq-pipeline.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step12. Construct trajectories.&#39;</span>)</span>
<span id="cb67-2"><a href="scrna-seq-pipeline.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/&#39;</span>))) {</span>
<span id="cb67-3"><a href="scrna-seq-pipeline.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/&#39;</span>))</span>
<span id="cb67-4"><a href="scrna-seq-pipeline.html#cb67-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-5"><a href="scrna-seq-pipeline.html#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="scrna-seq-pipeline.html#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/monocle2/&#39;</span>))) {</span>
<span id="cb67-7"><a href="scrna-seq-pipeline.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/monocle2/&#39;</span>))</span>
<span id="cb67-8"><a href="scrna-seq-pipeline.html#cb67-8" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb67-9"><a href="scrna-seq-pipeline.html#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="scrna-seq-pipeline.html#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/slingshot/&#39;</span>))) {</span>
<span id="cb67-11"><a href="scrna-seq-pipeline.html#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/slingshot/&#39;</span>))</span>
<span id="cb67-12"><a href="scrna-seq-pipeline.html#cb67-12" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb67-13"><a href="scrna-seq-pipeline.html#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="scrna-seq-pipeline.html#cb67-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/scVelo/&#39;</span>))) {</span>
<span id="cb67-15"><a href="scrna-seq-pipeline.html#cb67-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/scVelo/&#39;</span>))</span>
<span id="cb67-16"><a href="scrna-seq-pipeline.html#cb67-16" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<ul>
<li>Prepare the input data.</li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="scrna-seq-pipeline.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(Step12_Construct_Trajectories.clusters)){</span>
<span id="cb68-2"><a href="scrna-seq-pipeline.html#cb68-2" aria-hidden="true" tabindex="-1"></a>    sc_object.subset <span class="ot">&lt;-</span> sc_object</span>
<span id="cb68-3"><a href="scrna-seq-pipeline.html#cb68-3" aria-hidden="true" tabindex="-1"></a>    countsSlot.subset <span class="ot">&lt;-</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> sc_object.subset, <span class="at">slot =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb68-4"><a href="scrna-seq-pipeline.html#cb68-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb68-5"><a href="scrna-seq-pipeline.html#cb68-5" aria-hidden="true" tabindex="-1"></a>    sc_object.subset <span class="ot">&lt;-</span> <span class="fu">subset</span>(sc_object, <span class="at">subset =</span> selectLabels <span class="sc">%in%</span> Step12_Construct_Trajectories.clusters)</span>
<span id="cb68-6"><a href="scrna-seq-pipeline.html#cb68-6" aria-hidden="true" tabindex="-1"></a>    countsSlot.subset <span class="ot">&lt;-</span> <span class="fu">GetAssayData</span>(<span class="at">object =</span> sc_object.subset, <span class="at">slot =</span> <span class="st">&quot;counts&quot;</span>)</span>
<span id="cb68-7"><a href="scrna-seq-pipeline.html#cb68-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run monocle2.</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="scrna-seq-pipeline.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># monocle2</span></span>
<span id="cb69-2"><a href="scrna-seq-pipeline.html#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="scrna-seq-pipeline.html#cb69-3" aria-hidden="true" tabindex="-1"></a>phenoData <span class="ot">&lt;-</span> sc_object.subset<span class="sc">@</span>meta.data</span>
<span id="cb69-4"><a href="scrna-seq-pipeline.html#cb69-4" aria-hidden="true" tabindex="-1"></a>featureData <span class="ot">&lt;-</span> gene_metadata</span>
<span id="cb69-5"><a href="scrna-seq-pipeline.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">run_monocle</span>(<span class="at">cellData =</span> countsSlot.subset,</span>
<span id="cb69-6"><a href="scrna-seq-pipeline.html#cb69-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">phenoData =</span> phenoData,</span>
<span id="cb69-7"><a href="scrna-seq-pipeline.html#cb69-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">featureData =</span> featureData,</span>
<span id="cb69-8"><a href="scrna-seq-pipeline.html#cb69-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">lowerDetectionLimit =</span> <span class="fl">0.5</span>,</span>
<span id="cb69-9"><a href="scrna-seq-pipeline.html#cb69-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">expressionFamily =</span> VGAM<span class="sc">::</span><span class="fu">negbinomial.size</span>(),</span>
<span id="cb69-10"><a href="scrna-seq-pipeline.html#cb69-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">cellTypes=</span><span class="st">&#39;selectLabels&#39;</span>,</span>
<span id="cb69-11"><a href="scrna-seq-pipeline.html#cb69-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">monocle.orders=</span>Step12_Construct_Trajectories.clusters,</span>
<span id="cb69-12"><a href="scrna-seq-pipeline.html#cb69-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">monocle.colors =</span> ViolinPlot.cellTypeColors,</span>
<span id="cb69-13"><a href="scrna-seq-pipeline.html#cb69-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/monocle2/&#39;</span>))</span></code></pre></div>
<ul>
<li>Run slingshot.</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="scrna-seq-pipeline.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># slingshot</span></span>
<span id="cb70-2"><a href="scrna-seq-pipeline.html#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="scrna-seq-pipeline.html#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>( (<span class="fu">length</span>(input.data.dirs) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&amp;</span> Step2_Quality_Control.RemoveBatches ){</span>
<span id="cb70-4"><a href="scrna-seq-pipeline.html#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object.subset) <span class="ot">&lt;-</span> <span class="st">&#39;integrated&#39;</span></span>
<span id="cb70-5"><a href="scrna-seq-pipeline.html#cb70-5" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb70-6"><a href="scrna-seq-pipeline.html#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">DefaultAssay</span>(sc_object.subset) <span class="ot">&lt;-</span> <span class="st">&#39;RNA&#39;</span>}</span>
<span id="cb70-7"><a href="scrna-seq-pipeline.html#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">run_slingshot</span>(<span class="at">slingshot.PCAembeddings =</span> <span class="fu">Embeddings</span>(sc_object.subset, <span class="at">reduction =</span> <span class="st">&quot;pca&quot;</span>)[, PCs],</span>
<span id="cb70-8"><a href="scrna-seq-pipeline.html#cb70-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">slingshot.cellTypes =</span> sc_object.subset<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb70-9"><a href="scrna-seq-pipeline.html#cb70-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">slingshot.start.clus =</span> slingshot.start.clus,</span>
<span id="cb70-10"><a href="scrna-seq-pipeline.html#cb70-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">slingshot.end.clus =</span> slingshot.end.clus,</span>
<span id="cb70-11"><a href="scrna-seq-pipeline.html#cb70-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">slingshot.colors =</span> slingshot.colors,</span>
<span id="cb70-12"><a href="scrna-seq-pipeline.html#cb70-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/slingshot/&#39;</span>))</span></code></pre></div>
<ul>
<li>Run scVelo.</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="scrna-seq-pipeline.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scVelo</span></span>
<span id="cb71-2"><a href="scrna-seq-pipeline.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>((<span class="sc">!</span><span class="fu">is.null</span>(loom.files.path))<span class="sc">&amp;</span>(<span class="sc">!</span><span class="fu">is.null</span>(pythonPath))){</span>
<span id="cb71-3"><a href="scrna-seq-pipeline.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-4"><a href="scrna-seq-pipeline.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prepareDataForScvelo</span>(<span class="at">sc_object =</span> sc_object.subset,</span>
<span id="cb71-5"><a href="scrna-seq-pipeline.html#cb71-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">loom.files.path =</span> loom.files.path,</span>
<span id="cb71-6"><a href="scrna-seq-pipeline.html#cb71-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scvelo.reduction =</span> <span class="st">&#39;pca&#39;</span>,</span>
<span id="cb71-7"><a href="scrna-seq-pipeline.html#cb71-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scvelo.column =</span> <span class="st">&#39;selectLabels&#39;</span>,</span>
<span id="cb71-8"><a href="scrna-seq-pipeline.html#cb71-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step12.Construct_trajectories/scVelo/&#39;</span>))</span>
<span id="cb71-9"><a href="scrna-seq-pipeline.html#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="scrna-seq-pipeline.html#cb71-10" aria-hidden="true" tabindex="-1"></a>    reticulate<span class="sc">::</span><span class="fu">py_run_string</span>(<span class="fu">paste0</span>(<span class="st">&quot;import os</span><span class="sc">\n</span><span class="st">outputDir = &#39;&quot;</span>, output.dir, <span class="st">&quot;&#39;&quot;</span>))</span>
<span id="cb71-11"><a href="scrna-seq-pipeline.html#cb71-11" aria-hidden="true" tabindex="-1"></a>    reticulate<span class="sc">::</span><span class="fu">py_run_file</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;HemaScopeR&quot;</span>), <span class="st">&quot;python/sc_run_scvelo.py&quot;</span>), <span class="at">convert =</span> <span class="cn">FALSE</span>)</span>
<span id="cb71-12"><a href="scrna-seq-pipeline.html#cb71-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="scrna-seq-pipeline.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb72-2"><a href="scrna-seq-pipeline.html#cb72-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb72-3"><a href="scrna-seq-pipeline.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb72-4"><a href="scrna-seq-pipeline.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb72-5"><a href="scrna-seq-pipeline.html#cb72-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb72-6"><a href="scrna-seq-pipeline.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb72-7"><a href="scrna-seq-pipeline.html#cb72-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-13.-tf-analysis" class="section level2 hasAnchor" number="3.14">
<h2><span class="header-section-number">3.14</span> Step 13. TF Analysis<a href="scrna-seq-pipeline.html#step-13.-tf-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create folders for saving the results of TF analysis.</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="scrna-seq-pipeline.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step13. TF analysis.&#39;</span>)</span>
<span id="cb73-2"><a href="scrna-seq-pipeline.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step13.TF_analysis/&#39;</span>))) {</span>
<span id="cb73-3"><a href="scrna-seq-pipeline.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step13.TF_analysis/&#39;</span>))</span>
<span id="cb73-4"><a href="scrna-seq-pipeline.html#cb73-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run SCENIC to perform TF analysis.</li>
</ul>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="scrna-seq-pipeline.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run_SCENIC</span>(<span class="at">countMatrix =</span> countsSlot,</span>
<span id="cb74-2"><a href="scrna-seq-pipeline.html#cb74-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">cellTypes =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb74-3"><a href="scrna-seq-pipeline.html#cb74-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">datasetID =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID,</span>
<span id="cb74-4"><a href="scrna-seq-pipeline.html#cb74-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">cellTypes_colors =</span> Step13_TF_Analysis.cellTypes_colors,</span>
<span id="cb74-5"><a href="scrna-seq-pipeline.html#cb74-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">cellTypes_orders =</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels),</span>
<span id="cb74-6"><a href="scrna-seq-pipeline.html#cb74-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">groups_colors =</span> Step13_TF_Analysis.groups_colors,</span>
<span id="cb74-7"><a href="scrna-seq-pipeline.html#cb74-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">groups_orders =</span> <span class="fu">unique</span>(sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>datasetID),</span>
<span id="cb74-8"><a href="scrna-seq-pipeline.html#cb74-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">Org =</span> Org,</span>
<span id="cb74-9"><a href="scrna-seq-pipeline.html#cb74-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step13.TF_analysis/&#39;</span>),</span>
<span id="cb74-10"><a href="scrna-seq-pipeline.html#cb74-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">pythonPath =</span> pythonPath,</span>
<span id="cb74-11"><a href="scrna-seq-pipeline.html#cb74-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">databasePath =</span> databasePath)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="scrna-seq-pipeline.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb75-2"><a href="scrna-seq-pipeline.html#cb75-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb75-3"><a href="scrna-seq-pipeline.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb75-4"><a href="scrna-seq-pipeline.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb75-5"><a href="scrna-seq-pipeline.html#cb75-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb75-6"><a href="scrna-seq-pipeline.html#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb75-7"><a href="scrna-seq-pipeline.html#cb75-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="step-14.-cell-cell-interaction" class="section level2 hasAnchor" number="3.15">
<h2><span class="header-section-number">3.15</span> Step 14. Cell-Cell Interaction<a href="scrna-seq-pipeline.html#step-14.-cell-cell-interaction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Create folders for saving the results of cell-cell interaction analysis.</li>
</ul>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="scrna-seq-pipeline.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;Step14. Cell-cell interaction.&#39;</span>)</span>
<span id="cb76-2"><a href="scrna-seq-pipeline.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step14.Cell_cell_interection/&#39;</span>))) {</span>
<span id="cb76-3"><a href="scrna-seq-pipeline.html#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step14.Cell_cell_interection/&#39;</span>))</span>
<span id="cb76-4"><a href="scrna-seq-pipeline.html#cb76-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Run CellChat to perform cell-cell interaction analysis.</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="scrna-seq-pipeline.html#cb77-1" aria-hidden="true" tabindex="-1"></a>tempwd <span class="ot">&lt;-</span> <span class="fu">getwd</span>()</span>
<span id="cb77-2"><a href="scrna-seq-pipeline.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">run_CellChat</span>(<span class="at">data.input=</span>countsSlot,</span>
<span id="cb77-3"><a href="scrna-seq-pipeline.html#cb77-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">labels =</span> sc_object<span class="sc">@</span>meta.data<span class="sc">$</span>selectLabels,</span>
<span id="cb77-4"><a href="scrna-seq-pipeline.html#cb77-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">cell.orders =</span> ViolinPlot.cellTypeOrders,</span>
<span id="cb77-5"><a href="scrna-seq-pipeline.html#cb77-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">cell.colors =</span> ViolinPlot.cellTypeColors,</span>
<span id="cb77-6"><a href="scrna-seq-pipeline.html#cb77-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">sample.names =</span> <span class="fu">rownames</span>(sc_object<span class="sc">@</span>meta.data),</span>
<span id="cb77-7"><a href="scrna-seq-pipeline.html#cb77-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">Org =</span> Org,</span>
<span id="cb77-8"><a href="scrna-seq-pipeline.html#cb77-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">sorting =</span> sorting,</span>
<span id="cb77-9"><a href="scrna-seq-pipeline.html#cb77-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">output.dir =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/Step14.Cell_cell_interection/&#39;</span>))</span>
<span id="cb77-10"><a href="scrna-seq-pipeline.html#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(tempwd)</span></code></pre></div>
<ul>
<li>Save the variables.</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="scrna-seq-pipeline.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the names of all variables in the current environment</span></span>
<span id="cb78-2"><a href="scrna-seq-pipeline.html#cb78-2" aria-hidden="true" tabindex="-1"></a>variable_names <span class="ot">&lt;-</span> <span class="fu">ls</span>()</span>
<span id="cb78-3"><a href="scrna-seq-pipeline.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the variable names and save them as RDS files</span></span>
<span id="cb78-4"><a href="scrna-seq-pipeline.html#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> variable_names) {</span>
<span id="cb78-5"><a href="scrna-seq-pipeline.html#cb78-5" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> <span class="fu">get</span>(var_name)  <span class="co"># Get the variable by its name</span></span>
<span id="cb78-6"><a href="scrna-seq-pipeline.html#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(var, <span class="at">file =</span> <span class="fu">paste0</span>(output.dir, <span class="st">&#39;/RDSfiles/&#39;</span>, var_name, <span class="st">&quot;.rds&quot;</span>))  <span class="co"># Save as RDS with the variable&#39;s name</span></span>
<span id="cb78-7"><a href="scrna-seq-pipeline.html#cb78-7" aria-hidden="true" tabindex="-1"></a>}  </span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/scRNA_seq_pipeline.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
